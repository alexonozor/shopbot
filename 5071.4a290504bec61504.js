"use strict";(self.webpackChunkshopbot=self.webpackChunkshopbot||[]).push([[5071],{5071:(Y,b,i)=>{i.r(b),i.d(b,{BankAccountTabComponent:()=>x});var o=i(9417),B=i(6354),F=i(4412),C=i(5312),t=i(4020),y=i(1626);let u=(()=>{class e{constructor(a){this._httpClient=a,this.hostServer=C.c.hostServer,this.onBankChanged=new F.t({})}resolve(a,n){return this.routeParams=a.params,new Promise((s,r)=>{Promise.all([this.getBank()]).then(()=>{s(null)},r)})}getBank(){return new Promise((a,n)=>{this._httpClient.get(`${this.hostServer}/banks/${this.routeParams.id}`).subscribe(s=>{this.bank=s,this.onBankChanged.next(this.bank),a(s)},n)})}getStoreBank(a){return this._httpClient.get(`${this.hostServer}/banks/${a._id}/store`)}resolveBank({accountNumber:a,code:n}){return this._httpClient.get(`${this.hostServer}/banks/resolve?accountNumber=${a}&code=${n}`)}getBanksLists(){return this._httpClient.get(`${this.hostServer}/banks/paystack`)}getBanks(){return this._httpClient.get(`${this.hostServer}/banks`)}addBank(a){return this._httpClient.post(`${this.hostServer}/banks`,a)}updateBank(a,n){return this._httpClient.put(`${this.hostServer}/banks/${n}`,a)}static{this.\u0275fac=function(n){return new(n||e)(t.KVO(y.Qq))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac})}}return e})();var N=i(980),c=i(5351),f=i(2798),m=i(177),v=i(6924),k=i(636),E=i(3664),I=i(5416),h=i(2920),A=i(3);function T(e,l){if(1&e&&(t.j41(0,"mat-option",11),t.EFF(1),t.k0s()),2&e){const a=l.$implicit;t.Y8G("value",a),t.R7$(),t.SpI(" ",a.name," ")}}let S=(()=>{class e{constructor(a,n,s,r,p,U){this._formBuilder=a,this.auth=n,this.bankService=s,this.dialogRef=r,this.data=p,this.snack=U,this.isLoading=!1,this.banks=[],this.filteredDays=[]}ngOnInit(){this.banks=this.data.banks,this.bankForm=this.createBankForm(),this.data.isNew||this.bankForm.patchValue({code:this.data.bank.code,accountNumber:this.data.bank.accountNumber})}createBankForm(){return this._formBuilder.group({accountNumber:["",o.k0.required],code:["",o.k0.required]})}selectAccount(a){this.selectedBank=a.value,this.bankForm.patchValue({code:a.value.code})}save(){this.isLoading=!0,this.bankService.resolveBank({...this.bankForm.getRawValue()}).pipe((0,N.j)(()=>this.isLoading=!1)).subscribe(a=>{a.status?this.data.isNew?this.bankService.addBank({accountName:a.data.account_name,accountNumber:a.data.account_number,bankId:a.data.bank_id,bankName:this.selectedBank.name,store:this.data.storeId,code:this.selectedBank.code,type:this.selectedBank?.type,currency:this.data.currency}).subscribe(n=>{this.dialogRef.close(n)}):this.bankService.updateBank({accountName:a.data.account_name,accountNumber:a.data.account_number,bankId:a.data.bank_id,bankName:this.selectedBank.name,store:this.data.storeId,code:this.selectedBank.code,type:this.selectedBank?.type,currency:this.data.currency},this.data.bank._id).subscribe(n=>{this.snack.open("Account Details has been updated!","Close",{duration:2e3}),this.dialogRef.close(n)}):this.snack.open("Error: Unable to verify account","Close",{duration:2e3})})}static{this.\u0275fac=function(n){return new(n||e)(t.rXU(o.ok),t.rXU(E.u),t.rXU(u),t.rXU(c.CP),t.rXU(c.Vh),t.rXU(I.UG))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-add-bank"]],features:[t.Jv_([u])],decls:18,vars:5,consts:[["matDialogTitle",""],[1,"mat-typography"],["name","menuForm","fxLayout","column","fxFlex","",1,"product","w-100-p",3,"formGroup"],["appearance","fill"],[3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["appearance","fill","floatLabel","always",1,"w-100-p"],["matInput","","cancellation","Account Number","name","name","formControlName","accountNumber","required",""],["mat-dialog-actions","",1,"pt-24"],["mat-button","","mat-dialog-close",""],["mat-raised-button","",1,"mat-accent","mr-16",3,"click","disabled"],[3,"value"]],template:function(n,s){1&n&&(t.j41(0,"h1",0),t.EFF(1),t.k0s(),t.j41(2,"mat-dialog-content",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),t.EFF(6,"Bank Name"),t.k0s(),t.j41(7,"mat-select",4),t.bIt("selectionChange",function(p){return s.selectAccount(p)}),t.DNE(8,T,2,2,"mat-option",5),t.k0s()(),t.j41(9,"mat-form-field",6)(10,"mat-label"),t.EFF(11,"Account Number"),t.k0s(),t.nrm(12,"input",7),t.k0s()()(),t.j41(13,"div",8)(14,"button",9),t.EFF(15,"Cancel"),t.k0s(),t.j41(16,"button",10),t.bIt("click",function(){return s.save()}),t.EFF(17),t.k0s()()),2&n&&(t.R7$(),t.JRh(null!=s.data&&s.data.isNew?"Add Bank Details":null==s.data||null==s.data.bank?null:s.data.bank.accountName),t.R7$(2),t.Y8G("formGroup",s.bankForm),t.R7$(5),t.Y8G("ngForOf",s.banks),t.R7$(8),t.Y8G("disabled",!s.bankForm.valid&&s.isLoading),t.R7$(),t.JRh(s.isLoading?"Please wait..":"Save"))},dependencies:[m.MD,m.Sq,o.YN,o.qT,o.me,o.BC,o.cb,o.YS,o.X1,o.j4,o.JD,v.YF,h.DJ,h.UI,c.hM,c.tx,c.BI,c.E7,c.Yi,k.RG,k.rl,k.nJ,f.Ve,f.VO,A.wT],encapsulation:2})}}return e})();var d=i(3902),g=i(9183),j=i(8498),$=i(1997);function D(e,l){if(1&e&&(t.j41(0,"mat-list")(1,"div",9),t.EFF(2,"Bank Account Information"),t.k0s(),t.j41(3,"mat-list-item")(4,"span",10),t.EFF(5,"Bank Name"),t.k0s(),t.j41(6,"span",11),t.EFF(7),t.k0s()(),t.j41(8,"mat-list-item")(9,"span",10),t.EFF(10,"Account Name"),t.k0s(),t.j41(11,"span",11),t.EFF(12),t.k0s()(),t.j41(13,"mat-list-item")(14,"span",10),t.EFF(15,"Account Number"),t.k0s(),t.j41(16,"span",11),t.EFF(17),t.k0s()()()),2&e){const a=l.$implicit;t.R7$(7),t.JRh(a.bankName),t.R7$(5),t.JRh(a.accountName),t.R7$(5),t.JRh(a.accountNumber)}}function R(e,l){if(1&e){const a=t.RV6();t.j41(0,"div",5),t.DNE(1,D,18,3,"mat-list",6),t.nI1(2,"async"),t.nrm(3,"mat-divider"),t.j41(4,"div",7)(5,"button",8),t.bIt("click",function(){const s=t.eBV(a).$implicit,r=t.XpG(2);return t.Njj(r.addAccountDetails(!1,s))}),t.EFF(6,"UPDATE"),t.k0s()()()}if(2&e){t.XpG();const a=t.sdS(4),n=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.$bank))("ngIfElse",a)}}function L(e,l){if(1&e){const a=t.RV6();t.j41(0,"div",5)(1,"h3",12),t.EFF(2,"Bank Account Information"),t.k0s(),t.j41(3,"p",13),t.EFF(4,"You haven't add any bank account yet. Please add one."),t.k0s(),t.nrm(5,"mat-divider"),t.j41(6,"div",14)(7,"button",8),t.bIt("click",function(){t.eBV(a);const s=t.XpG(2);return t.Njj(s.addAccountDetails(!0))}),t.EFF(8,"ADD ACCOUNT"),t.k0s()()()}}function G(e,l){if(1&e&&(t.j41(0,"div",3),t.DNE(1,R,7,4,"div",4),t.nI1(2,"async"),t.DNE(3,L,9,0,"ng-template",null,1,t.C5r),t.k0s()),2&e){const a=t.sdS(4),n=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.$bank))("ngIfElse",a)}}function X(e,l){1&e&&(t.j41(0,"div",15),t.nrm(1,"mat-progress-spinner",16),t.k0s())}let x=(()=>{class e{constructor(a,n,s){this.bankService=a,this._matDialog=n,this.route=s,this.bankList=[],this.store=this.route.parent?.parent?.snapshot.data.store}ngOnInit(){this.getStoreBank(),this.getBankLists()}getStoreBank(){this.$bank=this.bankService.getStoreBank(this.store)}getBankLists(){this.$banks=this.bankService.getBanksLists().pipe((0,B.T)(a=>this.bankList=a.data))}addAccountDetails(a,n){this._matDialog.open(S,{disableClose:!1,data:{storeId:this.store._id,banks:this.bankList,isNew:a,bank:n,currency:this.store.currency}}).afterClosed().subscribe(r=>{r&&this.getStoreBank()})}static{this.\u0275fac=function(n){return new(n||e)(t.rXU(u),t.rXU(c.bZ),t.rXU(j.nX))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-bank-account-tab"]],inputs:{store:"store"},features:[t.Jv_([u])],decls:4,vars:4,consts:[["loading",""],["noBank",""],["style","padding:10px",4,"ngIf","ngIfElse"],[2,"padding","10px"],["class","mat-elevation-z6 example-container",4,"ngIf","ngIfElse"],[1,"mat-elevation-z6","example-container"],[4,"ngIf","ngIfElse"],[2,"padding","15px"],["mat-raised-button","","color","primary",3,"click"],["mat-subheader",""],["matListItemTitle",""],["matListItemLine",""],["matSubheader",""],[2,"text-align","center"],["fxLayout","row","fxLayoutAlign","center center",2,"padding","15px"],["fxLayout","row","fxLayoutAlign","center center",2,"padding","10px"],["mode","indeterminate","color","primary"]],template:function(n,s){if(1&n&&(t.DNE(0,G,5,4,"div",2),t.nI1(1,"async"),t.DNE(2,X,2,0,"ng-template",null,0,t.C5r)),2&n){const r=t.sdS(3);t.Y8G("ngIf",t.bMT(1,2,s.$banks))("ngIfElse",r)}},dependencies:[m.MD,m.bT,m.Jj,o.YN,o.X1,v.YF,h.DJ,h.sA,d.Fg,d.jt,d.YE,d.EI,$.q,d.C_,d.yE,g.D6,g.LG],encapsulation:2})}}return e})()}}]);