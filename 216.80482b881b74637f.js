"use strict";(self.webpackChunkshopbot=self.webpackChunkshopbot||[]).push([[216],{4216:(pt,F,m)=>{m.r(F),m.d(F,{OffersModule:()=>ct});var s=m(6814),g=m(1896),e=m(5879);let P=(()=>{class o{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-offers"]],decls:1,vars:0,template:function(r,n){1&r&&e._UZ(0,"router-outlet")},dependencies:[g.lC],encapsulation:2})}return o})();var G=m(553),V=m(9862);let h=(()=>{class o{constructor(t){this._httpClient=t,this.hostServer=G.N.hostServer}getOffers(){return this._httpClient.get(`${this.hostServer}/offers`)}getOffer(t){return this._httpClient.get(`${this.hostServer}/offers/${t}`)}deleteOffer(t){return this._httpClient.delete(`${this.hostServer}/offers/${t}`)}updateOffer(t,r){return this._httpClient.put(`${this.hostServer}/offers/${t}`,r)}createOffer(t){return this._httpClient.post(`${this.hostServer}/offers`,t)}static#e=this.\u0275fac=function(r){return new(r||o)(e.LFG(V.eN))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac})}return o})();var w=m(7700),y=m(2296),O=m(617),b=m(7988),u=m(3814);function k(o,a){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.BQk()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.AsE(" ",e.xi3(2,2,t.startTime,"medium")," - ",e.xi3(3,5,t.endTime,"medium")," ")}}function $(o,a){1&o&&(e.ynx(0),e._uU(1," Recurring offer "),e.BQk())}const B=function(o){return["../",o,"edit"]};function R(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",7)(1,"th",8),e._UZ(2,"img",9),e.TgZ(3,"div",10)(4,"div",11),e._uU(5),e.qZA(),e.TgZ(6,"div",12),e._uU(7),e.qZA()()(),e.TgZ(8,"td",13),e._uU(9),e.qZA(),e.TgZ(10,"td",13),e._uU(11),e.qZA(),e.TgZ(12,"td",13),e._uU(13),e.qZA(),e.TgZ(14,"td",13),e.YNc(15,k,4,8,"ng-container",14),e.YNc(16,$,2,0,"ng-container",14),e.qZA(),e.TgZ(17,"td",13)(18,"button",15)(19,"mat-icon"),e._uU(20,"more_vert"),e.qZA()(),e.TgZ(21,"mat-menu",null,16)(23,"button",17),e.NdJ("click",function(){const n=e.CHM(t),i=n.$implicit,l=n.index,v=e.oxw();return e.KtG(v.deleteOffer(i._id,l))}),e.TgZ(24,"mat-icon",18),e._uU(25,"delete"),e.qZA(),e.TgZ(26,"span"),e._uU(27,"Delete"),e.qZA()(),e.TgZ(28,"button",19)(29,"mat-icon",18),e._uU(30,"visibility"),e.qZA(),e.TgZ(31,"span"),e._uU(32,"Edit Offer"),e.qZA()()()()()}if(2&o){const t=a.$implicit,r=e.MAs(22);e.xp6(2),e.Q6J("src",t.image,e.LSH),e.xp6(3),e.Oqu(t.store.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",(null==t||null==t.menu?null:t.menu.name)||"Applied to all"," "),e.xp6(2),e.hij(" ",(null==t||null==t.food?null:t.food.name)||"Applied to all"," "),e.xp6(2),e.hij(" ",t.discount," "),e.xp6(2),e.Q6J("ngIf","One Time"===t.offerPeriodType),e.xp6(1),e.Q6J("ngIf","One Time"!==t.offerPeriodType),e.xp6(2),e.Q6J("matMenuTriggerFor",r),e.xp6(10),e.Q6J("routerLink",e.VKq(10,B,t._id))}}const j=function(){return["../","new-offer"]};let W=(()=>{class o{constructor(t,r,n){this.route=t,this.offerService=r,this._matDialog=n}ngOnInit(){this.offers=this.route.snapshot.data.offers}deleteOffer(t,r){this.offers.splice(r,1),this.offerService.deleteOffer(t).subscribe()}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(g.gz),e.Y36(h),e.Y36(w.uw))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-offers-list"]],decls:26,vars:3,consts:[[1,"relative","overflow-x-auto","shadow-md","sm:rounded-lg"],["fxLayout","row","fxLayoutAlign","space-between center",1,"p-4","bg-white"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"w-full","text-sm","text-left","text-gray-500"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50"],["scope","col",1,"px-6","py-3"],["class","bg-white border-b  hover:bg-gray-50 ",4,"ngFor","ngForOf"],[1,"bg-white","border-b","hover:bg-gray-50"],["scope","row",1,"flex","items-center","px-6","py-4","text-gray-900","whitespace-nowrap"],["alt","Jese image",1,"w-10","h-10","rounded-full",3,"src"],[1,"pl-3"],[1,"text-base","font-semibold"],[1,"font-normal","text-gray-500"],[1,"px-6","py-4"],[4,"ngIf"],["mat-icon-button","","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"material-icons-outlined"],["mat-menu-item","",3,"routerLink"]],template:function(r,n){1&r&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2"),e._uU(3,"Offers"),e.qZA(),e.TgZ(4,"div")(5,"button",2)(6,"mat-icon"),e._uU(7,"add"),e.qZA(),e._uU(8," Add Offers"),e.qZA()()(),e.TgZ(9,"table",3)(10,"thead",4)(11,"tr")(12,"th",5),e._uU(13," Store "),e.qZA(),e.TgZ(14,"th",5),e._uU(15," Menu "),e.qZA(),e.TgZ(16,"th",5),e._uU(17," Product "),e.qZA(),e.TgZ(18,"th",5),e._uU(19," Discount "),e.qZA(),e.TgZ(20,"th",5),e._uU(21," Duration "),e.qZA(),e.TgZ(22,"th",5),e._uU(23," Action "),e.qZA()()(),e.TgZ(24,"tbody"),e.YNc(25,R,33,12,"tr",6),e.qZA()()()),2&r&&(e.xp6(5),e.Q6J("routerLink",e.DdM(2,j)),e.xp6(20),e.Q6J("ngForOf",n.offers))},dependencies:[s.sg,s.O5,g.rH,y.lW,y.RK,O.Hw,b.VK,b.OP,b.p6,u.xw,u.Wh,s.uU]})}return o})();var Z=m(6028),f=m(6223),x=m(7921),C=m(7398),S=m(6116),A=m(1803),q=m(6284),N=m(940),U=m(3680),d=m(9157),J=m(2032),I=m(8525),Q=m(5986),c=m(8034),M=m(3064),T=m(9023);const H=["customerInput"],K=["auto"],z=["storeInput"],X=["storeAuto"];function ee(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.name," ")}}function te(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}function oe(o,a){1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Enter the quantity the buyer needs to order"),e.qZA(),e._UZ(3,"input",19),e.qZA())}function ne(o,a){1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Enter to the quantity the buy will receive"),e.qZA(),e._UZ(3,"input",20),e.qZA())}function re(o,a){1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Enter the discount"),e.qZA(),e._UZ(3,"input",21),e.TgZ(4,"mat-icon",22),e._uU(5,"percent"),e.qZA()())}function ae(o,a){1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Enter the amount the user have to order"),e.qZA(),e._UZ(3,"input",23),e.TgZ(4,"mat-icon",22),e._uU(5,"money"),e.qZA()())}function ie(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function fe(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function me(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Select a menu"),e.qZA(),e.TgZ(3,"mat-select",24),e.NdJ("selectionChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.selectedMenu(n))}),e.YNc(4,fe,2,2,"mat-option",7),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("compareWith",t.objectComparisonFunction),e.xp6(1),e.Q6J("ngForOf",t.menus)}}function le(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.name," ")}}function se(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Select a menu Item"),e.qZA(),e.TgZ(3,"mat-select",25),e.YNc(4,le,2,2,"mat-option",7),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.selectMenu.foods)}}function ue(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function ce(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid start date"),e.qZA())}function pe(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid end date"),e.qZA())}function de(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Offer Start/End Period"),e.qZA(),e.TgZ(3,"mat-date-range-input",26),e._UZ(4,"input",27)(5,"input",28),e.qZA(),e._UZ(6,"mat-datepicker-toggle",29)(7,"mat-date-range-picker",null,30),e.YNc(9,ce,2,0,"mat-error",31),e.YNc(10,pe,2,0,"mat-error",31),e.qZA()),2&o){const t=e.MAs(8),r=e.oxw();e.xp6(3),e.Q6J("rangePicker",t),e.xp6(3),e.Q6J("for",t),e.xp6(3),e.Q6J("ngIf",r.range.controls.start.hasError("matStartDateInvalid")),e.xp6(1),e.Q6J("ngIf",r.range.controls.end.hasError("matEndDateInvalid"))}}function _e(o,a){if(1&o&&(e.TgZ(0,"div",34),e.ynx(1,35),e.TgZ(2,"mat-checkbox",36),e._uU(3),e.qZA(),e._UZ(4,"ngx-mat-timepicker",37)(5,"ngx-mat-timepicker",38),e.BQk(),e.qZA()),2&o){const t=a.$implicit,r=a.index;e.xp6(1),e.Q6J("formGroupName",r),e.xp6(2),e.Oqu(t.value.day),e.xp6(1),e.Q6J("enableMeridian",!0),e.xp6(1),e.Q6J("enableMeridian",!0)}}function ge(o,a){if(1&o&&(e.TgZ(0,"div",32),e.YNc(1,_e,6,4,"div",33),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.offerPeriods.controls)}}function he(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}const ye=function(){return{name:"Discount",value:0}},Te=function(){return{name:"Buy x get x free",value:1}},ve=function(){return{name:"Buy x, Get %(x) Off",value:2}},Ze=function(){return{name:"%(x) Off, up to (x) amount of order",value:3}},xe=function(o,a,t,r){return[o,a,t,r]},Ce=function(){return["Entire menu","Single menu","Single Item"]},we=function(){return["One Time","Recurring"]},Oe=function(){return{name:"Enable",value:!0}},be=function(){return{name:"Disable",value:!1}},Ae=function(o,a){return[o,a]};let Ne=(()=>{class o{constructor(t,r,n,i,l,v,D,p){this.fb=t,this.offersService=r,this.usersService=n,this.storesService=i,this.location=l,this.dialog=v,this.menuService=D,this.route=p,this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.separatorKeysCodes=[Z.K5,Z.OC],this.menuCtrl=new f.NI,this.storeCtrl=new f.NI,this.isLoading=!1,this.selectedCustomers=[],this.range=new f.cw({start:new f.NI(null),end:new f.NI(null)}),this.panelOpenState=!1,this.availableDays=[{day:"Sunday",active:!0,startDate:new Date,endDate:new Date},{day:"Monday",active:!0,startDate:new Date,endDate:new Date},{day:"Tuesday",active:!0,startDate:new Date,endDate:new Date},{day:"Wednesday",active:!0,startDate:new Date,endDate:new Date},{day:"Thursday",active:!0,startDate:new Date,endDate:new Date},{day:"Friday",active:!0,startDate:new Date,endDate:new Date},{day:"Saturday",active:!0,startDate:new Date,endDate:new Date}],this.filteredDays=[],this.menus=[],this.stores=[],this.offer=this.route.snapshot.data.offer,this.selectedStore=this.offer.store,this.selectMenu=this.offer.menu,this.getStores(),this.getMenu(this.selectedStore._id),this.promoForm=this.fb.group({image:[this.offer?.image],menu:[this.offer?.menu?._id],applicableType:[this.offer?.applicableType],quantityForFree:[this.offer?.quantityForFree],quantityToOrder:[this.offer?.quantityToOrder],food:[this.offer?.food?._id],offerType:[this.offer?.offerType,f.kI.required],offerPeriodType:[this.offer?.offerPeriodType,f.kI.required],offerPeriodDays:this.fb.array([]),store:[this.offer?.store?._id],amount:[this.offer?.amount],discount:[this.offer?.discount],startTime:[this.offer?.startTime],endTime:[this.offer?.endTime],enabled:[this.offer?.enabled],description:[this.offer?.description,f.kI.required]}),this.offer.offerPeriodDays.forEach(_=>{this.addOfferPeriods(_)}),this.mediaData={image:this.offer?.image,icon:null},this.filteredMenus=this.menuCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(_=>_?this._filter(_):this.menus.slice())),this.filteredStores=this.storeCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(_=>_?this._filterStore(_):this.stores.slice()))}addOfferPeriods(t){const r=this.fb.group({day:t.day,active:t.active,startDate:new Date(t.startDate),endDate:new Date(t.endDate)});this.offerPeriods.push(r)}get offerPeriods(){return this.promoForm.controls.offerPeriodDays}ngOnInit(){}_filter(t){if("string"==typeof t){const r=t?.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}_filterStore(t){if("string"==typeof t){const r=t?.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}displayFn(t){return t?.name}submit(){if(this.promoForm.valid){let t=this.promoForm.getRawValue();t.menu=this.selectMenu?._id,this.isLoading=!0,this.offersService.updateOffer(this.offer._id,t).subscribe(r=>{this.isLoading=!1,this.location.back()})}}objectComparisonFunction(t,r){return t.id===r.id}selectStore(t){this.getMenu(t.value)}getMenu(t){this.menuService.getStoreMenus(t).subscribe(r=>{this.menus=r})}selectedMenu(t){this.selectMenu=t.value}getStores(){this.storesService.getStores({data:{$match:{}},control:[{$sort:{createdAt:-1}}]}).subscribe(t=>{this.stores=t})}back(){this.location.back()}addMedia(t){this.dialog.open(S.R).afterClosed().subscribe(n=>{n&&(this.promoForm.patchValue({[t]:n.url}),this.mediaData[t]={[t]:n}[t])})}removeValue(t){this.promoForm.patchValue({[t]:null}),this.mediaData[t]=null}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(f.qu),e.Y36(h),e.Y36(A.f),e.Y36(q._),e.Y36(s.Ye),e.Y36(w.uw),e.Y36(N.O),e.Y36(g.gz))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-edit-offer"]],viewQuery:function(r,n){if(1&r&&(e.Gf(H,5),e.Gf(K,5),e.Gf(z,5),e.Gf(X,5)),2&r){let i;e.iGM(i=e.CRH())&&(n.customerInput=i.first),e.iGM(i=e.CRH())&&(n.matAutocomplete=i.first),e.iGM(i=e.CRH())&&(n.storeInput=i.first),e.iGM(i=e.CRH())&&(n.matAutocompleteStore=i.first)}},decls:47,vars:34,consts:[[1,"mat-elevation-z3","container","mx-auto","my-10","container-md","p-5"],[3,"formGroup","ngSubmit"],["fxLayout","column","fxLayoutAlign","start start"],["fxLayout","column","fxLayoutAlign","center center",1,"m-3","w-full"],["valueName","Image",3,"isNew","mediaData","removeValue","openMediaBrowser"],[1,"w-full"],["formControlName","store",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","applicableType"],["class","w-full",4,"ngIf"],["formControlName","offerType"],["formControlName","offerPeriodType"],["formArrayName","offerPeriodDays","class","w-full",4,"ngIf"],["matInput","","cancellation","Text Description","formControlName","description"],["formControlName","enabled"],["fxLayout.gt-md","row","fxLayoutAlign.gt-md","space-around start","fxLayout.lt-lg","column","fxLayoutAlign.lt-lg","space-around stretch","fxLayoutGap","10px",1,"w-full"],["mat-raised-button","","fxFlex","50%",3,"click"],["mat-raised-button","","fxFlex","50%","color","primary",3,"disabled"],[3,"value"],["matInput","","type","number","cancellation","Enter the quantity the buyer needs to order","formControlName","quantityToOrder"],["matInput","","type","number","cancellation","Enter to the quantity the buyer will receive","formControlName","quantityForFree"],["matInput","","type","number","cancellation","Enter Discount","formControlName","discount"],["matSuffix",""],["matInput","","type","number","cancellation","Enter the amount the user have to order","formControlName","amount"],["formControlName","menu",3,"compareWith","selectionChange"],["formControlName","food"],[3,"rangePicker"],["matStartDate","","formControlName","startTime","placeholder","Start date"],["matEndDate","","formControlName","endTime","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],[4,"ngIf"],["formArrayName","offerPeriodDays",1,"w-full"],["class","p-3 border-b-2 border-b-gray w-full","fxLayout","row","fxLayoutAlign","space-around center",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-around center",1,"p-3","border-b-2","border-b-gray","w-full"],[3,"formGroupName"],["formControlName","active"],["formControlName","startDate",3,"enableMeridian"],["formControlName","endDate",3,"enableMeridian"]],template:function(r,n){1&r&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return n.submit()}),e.TgZ(2,"div",2)(3,"div",3)(4,"app-select-media",4),e.NdJ("removeValue",function(l){return n.removeValue(l)})("openMediaBrowser",function(l){return n.addMedia(l)}),e.qZA()(),e.TgZ(5,"mat-form-field",5)(6,"mat-label"),e._uU(7,"Select a vendor"),e.qZA(),e.TgZ(8,"mat-select",6),e.NdJ("selectionChange",function(l){return n.selectStore(l)}),e.YNc(9,ee,2,2,"mat-option",7),e.qZA()(),e.TgZ(10,"mat-form-field",5)(11,"mat-label"),e._uU(12,"What kind of offer do you want create?"),e.qZA(),e.TgZ(13,"mat-select",8),e.YNc(14,te,2,2,"mat-option",7),e.qZA()(),e.YNc(15,oe,4,0,"mat-form-field",9),e.YNc(16,ne,4,0,"mat-form-field",9),e.YNc(17,re,6,0,"mat-form-field",9),e.YNc(18,ae,6,0,"mat-form-field",9),e.TgZ(19,"mat-form-field",5)(20,"mat-label"),e._uU(21,"Where do you want to apply this offer?"),e.qZA(),e.TgZ(22,"mat-select",10),e.YNc(23,ie,2,2,"mat-option",7),e.qZA()(),e.YNc(24,me,5,2,"mat-form-field",9),e.YNc(25,se,5,1,"mat-form-field",9),e.TgZ(26,"mat-form-field",5)(27,"mat-label"),e._uU(28,"Offer Period Type"),e.qZA(),e.TgZ(29,"mat-select",11),e.YNc(30,ue,2,2,"mat-option",7),e.qZA()(),e.YNc(31,de,11,4,"mat-form-field",9),e.YNc(32,ge,2,1,"div",12),e.TgZ(33,"mat-form-field",5)(34,"mat-label"),e._uU(35,"Description"),e.qZA(),e._UZ(36,"textarea",13),e.qZA(),e.TgZ(37,"mat-form-field",5)(38,"mat-label"),e._uU(39,"Enabled?"),e.qZA(),e.TgZ(40,"mat-select",14),e.YNc(41,he,2,2,"mat-option",7),e.qZA()(),e.TgZ(42,"div",15)(43,"a",16),e.NdJ("click",function(){return n.back()}),e._uU(44,"CANCEL"),e.qZA(),e.TgZ(45,"button",17),e._uU(46),e.qZA()()()()()),2&r&&(e.xp6(1),e.Q6J("formGroup",n.promoForm),e.xp6(3),e.Q6J("isNew",!1)("mediaData",null==n.mediaData?null:n.mediaData.image),e.xp6(5),e.Q6J("ngForOf",n.stores),e.xp6(5),e.Q6J("ngForOf",e.l5B(22,xe,e.DdM(18,ye),e.DdM(19,Te),e.DdM(20,ve),e.DdM(21,Ze))),e.xp6(1),e.Q6J("ngIf",1===n.promoForm.value.applicableType||2===n.promoForm.value.applicableType),e.xp6(1),e.Q6J("ngIf",1===n.promoForm.value.applicableType),e.xp6(1),e.Q6J("ngIf",0===n.promoForm.value.applicableType||2===n.promoForm.value.applicableType||3===n.promoForm.value.applicableType),e.xp6(1),e.Q6J("ngIf",3===n.promoForm.value.applicableType),e.xp6(5),e.Q6J("ngForOf",e.DdM(27,Ce)),e.xp6(1),e.Q6J("ngIf","Single menu"===n.promoForm.value.offerType||"Single Item"===n.promoForm.value.offerType&&n.selectedStore),e.xp6(1),e.Q6J("ngIf","Single Item"===n.promoForm.value.offerType&&n.selectMenu),e.xp6(5),e.Q6J("ngForOf",e.DdM(28,we)),e.xp6(1),e.Q6J("ngIf","One Time"===n.promoForm.value.offerPeriodType),e.xp6(1),e.Q6J("ngIf","Recurring"===n.promoForm.value.offerPeriodType),e.xp6(9),e.Q6J("ngForOf",e.WLB(31,Ae,e.DdM(29,Oe),e.DdM(30,be))),e.xp6(4),e.Q6J("disabled",n.promoForm.invalid),e.xp6(1),e.Oqu(n.isLoading?"CHECKING...":"SAVE"))},dependencies:[s.sg,s.O5,U.ey,y.zs,y.lW,d.KE,d.hX,d.TO,d.R9,O.Hw,J.Nt,I.gD,Q.oG,c.nW,c.wx,c.zY,c.By,c._g,u.xw,u.SQ,u.Wh,u.yH,f._Y,f.Fj,f.wV,f.JJ,f.JL,f.sg,f.u,f.x0,f.CE,M.t,T.ft]})}return o})(),E=(()=>{class o{constructor(t){this.offersService=t}resolve(){return this.offersService.getOffers()}static#e=this.\u0275fac=function(r){return new(r||o)(e.LFG(h))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),L=(()=>{class o{constructor(t){this.offerService=t}resolve(t){const r=t.paramMap.get("id");return this.offerService.getOffer(r)}static#e=this.\u0275fac=function(r){return new(r||o)(e.LFG(h))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Y=m(4630);const De=["customerInput"],Fe=["auto"],Se=["storeInput"],qe=["storeAuto"];function Ue(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Je(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}function Ie(o,a){1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Enter the quantity the buyer needs to order"),e.qZA(),e._UZ(3,"input",23),e.qZA())}function Qe(o,a){1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Enter to the quantity the buy will receive"),e.qZA(),e._UZ(3,"input",24),e.qZA())}function Me(o,a){1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Enter the discount"),e.qZA(),e._UZ(3,"input",25),e.TgZ(4,"mat-icon",26),e._uU(5,"percent"),e.qZA()())}function Ee(o,a){1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Enter the amount"),e.qZA(),e._UZ(3,"input",27),e.TgZ(4,"mat-icon",26),e._uU(5,"money"),e.qZA()())}function Le(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function Ye(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Pe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Select a menu"),e.qZA(),e._UZ(3,"input",28,29),e.TgZ(5,"mat-autocomplete",8,30),e.NdJ("optionSelected",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.selectedMenu(n))}),e.YNc(7,Ye,2,2,"mat-option",10),e.ALo(8,"async"),e.qZA()()}if(2&o){const t=e.MAs(6),r=e.oxw();e.xp6(3),e.Q6J("formControl",r.menuCtrl)("matAutocomplete",t),e.xp6(2),e.Q6J("displayWith",r.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,4,r.filteredMenus))}}function Ge(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.name," ")}}function Ve(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Select a menu Item"),e.qZA(),e.TgZ(3,"mat-select",31),e.YNc(4,Ge,2,2,"mat-option",10),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.selectMenu.foods)}}function ke(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function $e(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid start date"),e.qZA())}function Be(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid end date"),e.qZA())}function Re(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Offer Start/End Period"),e.qZA(),e.TgZ(3,"mat-date-range-input",32),e._UZ(4,"input",33)(5,"input",34),e.qZA(),e._UZ(6,"mat-datepicker-toggle",35)(7,"mat-date-range-picker",null,36),e.YNc(9,$e,2,0,"mat-error",37),e.YNc(10,Be,2,0,"mat-error",37),e.qZA()),2&o){const t=e.MAs(8),r=e.oxw();e.xp6(3),e.Q6J("rangePicker",t),e.xp6(3),e.Q6J("for",t),e.xp6(3),e.Q6J("ngIf",r.range.controls.start.hasError("matStartDateInvalid")),e.xp6(1),e.Q6J("ngIf",r.range.controls.end.hasError("matEndDateInvalid"))}}function je(o,a){if(1&o&&(e.TgZ(0,"div",40),e.ynx(1,41),e.TgZ(2,"mat-checkbox",42),e._uU(3),e.qZA(),e._UZ(4,"ngx-mat-timepicker",43)(5,"ngx-mat-timepicker",44),e.BQk(),e.qZA()),2&o){const t=a.$implicit,r=a.index;e.xp6(1),e.Q6J("formGroupName",r),e.xp6(2),e.Oqu(t.value.day),e.xp6(1),e.Q6J("enableMeridian",!0),e.xp6(1),e.Q6J("enableMeridian",!0)}}function We(o,a){if(1&o&&(e.TgZ(0,"div",38),e.YNc(1,je,6,4,"div",39),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.offerPeriods.controls)}}function He(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}const Ke=function(){return{name:"Discount",value:0}},ze=function(){return{name:"Buy x get x free",value:1}},Xe=function(){return{name:"Buy x, Get %(x) Off",value:2}},et=function(){return{name:"%(x) Off, up to (x) amount of order",value:3}},tt=function(o,a,t,r){return[o,a,t,r]},ot=function(){return["Entire menu","Single menu","Single Item"]},nt=function(){return["One Time","Recurring"]},rt=function(){return{name:"Enable",value:!0}},at=function(){return{name:"Disable",value:!1}},it=function(o,a){return[o,a]},ft=[{path:"",component:P,children:[{path:"list",component:W,resolve:{offers:E}},{path:"new-offer",component:(()=>{class o{constructor(t,r,n,i,l,v,D){this.fb=t,this.offersService=r,this.usersService=n,this.storesService=i,this.location=l,this.dialog=v,this.menuService=D,this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.separatorKeysCodes=[Z.K5,Z.OC],this.menuCtrl=new f.NI,this.storeCtrl=new f.NI,this.isLoading=!1,this.selectedCustomers=[],this.range=new f.cw({start:new f.NI(null),end:new f.NI(null)}),this.panelOpenState=!1,this.availableDays=[{day:"Sunday",active:!0,startDate:new Date,endDate:new Date},{day:"Monday",active:!0,startDate:new Date,endDate:new Date},{day:"Tuesday",active:!0,startDate:new Date,endDate:new Date},{day:"Wednesday",active:!0,startDate:new Date,endDate:new Date},{day:"Thursday",active:!0,startDate:new Date,endDate:new Date},{day:"Friday",active:!0,startDate:new Date,endDate:new Date},{day:"Saturday",active:!0,startDate:new Date,endDate:new Date}],this.filteredDays=[],this.menus=[],this.stores=[],this.promoForm=this.fb.group({image:[""],menu:[null],food:[null],applicableType:["",f.kI.required],quantityForFree:[0],quantityToOrder:[0],offerType:["",f.kI.required],offerPeriodType:["",f.kI.required],offerPeriodDays:this.fb.array([]),store:[""],discount:[0],amount:[0],startTime:[this.range.value.start],endTime:[this.range.value.end],description:["",f.kI.required],enabled:[!1,f.kI.required]}),this.availableDays.forEach(p=>{this.addOfferPeriods(p)}),this.getStores(),this.mediaData={image:null,icon:null},this.filteredMenus=this.menuCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(p=>p?this._filter(p):this.menus.slice())),this.filteredStores=this.storeCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(p=>p?this._filterStore(p):this.stores.slice()))}addOfferPeriods(t){const r=this.fb.group({day:t.day,active:t.active,startDate:t.startDate,endDate:t.endDate});this.offerPeriods.push(r)}get offerPeriods(){return this.promoForm.controls.offerPeriodDays}ngOnInit(){}_filter(t){if("string"==typeof t){const r=t?.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}_filterStore(t){if("string"==typeof t){const r=t?.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}displayFn(t){return t?.name}submit(){if(this.promoForm.valid){let t=this.promoForm.getRawValue();t.store=this.selectedStore._id,t.menu=this.selectMenu?._id,this.isLoading=!0,this.offersService.createOffer(t).subscribe(r=>{this.isLoading=!1,this.location.back()})}}selectStore(t){this.selectedStore=t.option.value,setTimeout(()=>{this.getMenu()},2e3)}getMenu(){this.selectedStore&&this.menuService.getStoreMenus(this.selectedStore._id).subscribe(t=>{this.menus=t})}selectedMenu(t){this.selectMenu=t.option.value}getStores(){this.storesService.getStores({data:{$match:{}},control:[{$sort:{createdAt:-1}}]}).subscribe(t=>{this.stores=t})}back(){this.location.back()}addMedia(t){this.dialog.open(S.R).afterClosed().subscribe(n=>{n&&(this.promoForm.patchValue({[t]:n.url}),this.mediaData[t]={[t]:n}[t])})}removeValue(t){this.promoForm.patchValue({[t]:null}),this.mediaData[t]=null}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(f.qu),e.Y36(h),e.Y36(A.f),e.Y36(q._),e.Y36(s.Ye),e.Y36(w.uw),e.Y36(N.O))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-new-offer"]],viewQuery:function(r,n){if(1&r&&(e.Gf(De,5),e.Gf(Fe,5),e.Gf(Se,5),e.Gf(qe,5)),2&r){let i;e.iGM(i=e.CRH())&&(n.customerInput=i.first),e.iGM(i=e.CRH())&&(n.matAutocomplete=i.first),e.iGM(i=e.CRH())&&(n.storeInput=i.first),e.iGM(i=e.CRH())&&(n.matAutocompleteStore=i.first)}},decls:51,vars:39,consts:[[1,"mat-elevation-z3","container","mx-auto","my-10","container-md","p-5"],[3,"formGroup","ngSubmit"],["fxLayout","column","fxLayoutAlign","start start"],["fxLayout","column","fxLayoutAlign","center center",1,"m-3","w-full"],["valueName","Image",3,"isNew","mediaData","removeValue","openMediaBrowser"],["fxFlex.gt-md","50%","fxFlex.lt-lg","100%",1,"w-full"],["matInput","","cancellation","Select a vendor","formControlName","store",3,"formControl","matAutocomplete"],["storeInput",""],[3,"displayWith","optionSelected"],["storeAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full"],["formControlName","applicableType"],["class","w-full",4,"ngIf"],["formControlName","offerType"],["formControlName","offerPeriodType"],["formArrayName","offerPeriodDays","class","w-full",4,"ngIf"],["matInput","","cancellation","Text Description","formControlName","description"],["formControlName","enabled"],["fxLayout.gt-md","row","fxLayoutAlign.gt-md","space-around start","fxLayout.lt-lg","column","fxLayoutAlign.lt-lg","space-around stretch","fxLayoutGap","10px",1,"w-full"],["mat-raised-button","","fxFlex","50%",3,"click"],["mat-raised-button","","fxFlex","50%","color","primary",3,"disabled"],[3,"value"],["matInput","","type","number","cancellation","Enter the quantity the buyer needs to order","formControlName","quantityToOrder"],["matInput","","type","number","cancellation","Enter to the quantity the buyer will receive","formControlName","quantityForFree"],["matInput","","type","number","cancellation","Enter Discount","formControlName","discount"],["matSuffix",""],["matInput","","type","number","cancellation","Enter amount","formControlName","amount"],["matInput","","cancellation","Select a menu","formControlName","menu",3,"formControl","matAutocomplete"],["menuInput",""],["menuAuto","matAutocomplete"],["formControlName","food"],[3,"rangePicker"],["matStartDate","","formControlName","startTime","placeholder","Start date"],["matEndDate","","formControlName","endTime","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],[4,"ngIf"],["formArrayName","offerPeriodDays",1,"w-full"],["class","p-3 border-b-2 border-b-gray w-full","fxLayout","row","fxLayoutAlign","space-around center",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-around center",1,"p-3","border-b-2","border-b-gray","w-full"],[3,"formGroupName"],["formControlName","active"],["formControlName","startDate",3,"enableMeridian"],["formControlName","endDate",3,"enableMeridian"]],template:function(r,n){if(1&r&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return n.submit()}),e.TgZ(2,"div",2)(3,"div",3)(4,"app-select-media",4),e.NdJ("removeValue",function(l){return n.removeValue(l)})("openMediaBrowser",function(l){return n.addMedia(l)}),e.qZA()(),e.TgZ(5,"mat-form-field",5)(6,"mat-label"),e._uU(7,"Select a vendor"),e.qZA(),e._UZ(8,"input",6,7),e.TgZ(10,"mat-autocomplete",8,9),e.NdJ("optionSelected",function(l){return n.selectStore(l)}),e.YNc(12,Ue,2,2,"mat-option",10),e.ALo(13,"async"),e.qZA()(),e.TgZ(14,"mat-form-field",11)(15,"mat-label"),e._uU(16,"What kind of offer do you want create?"),e.qZA(),e.TgZ(17,"mat-select",12),e.YNc(18,Je,2,2,"mat-option",10),e.qZA()(),e.YNc(19,Ie,4,0,"mat-form-field",13),e.YNc(20,Qe,4,0,"mat-form-field",13),e.YNc(21,Me,6,0,"mat-form-field",13),e.YNc(22,Ee,6,0,"mat-form-field",13),e.TgZ(23,"mat-form-field",11)(24,"mat-label"),e._uU(25,"Where do you want to apply this offer?"),e.qZA(),e.TgZ(26,"mat-select",14),e.YNc(27,Le,2,2,"mat-option",10),e.qZA()(),e.YNc(28,Pe,9,6,"mat-form-field",13),e.YNc(29,Ve,5,1,"mat-form-field",13),e.TgZ(30,"mat-form-field",11)(31,"mat-label"),e._uU(32,"Offer Period Type"),e.qZA(),e.TgZ(33,"mat-select",15),e.YNc(34,ke,2,2,"mat-option",10),e.qZA()(),e.YNc(35,Re,11,4,"mat-form-field",13),e.YNc(36,We,2,1,"div",16),e.TgZ(37,"mat-form-field",11)(38,"mat-label"),e._uU(39,"Description"),e.qZA(),e._UZ(40,"textarea",17),e.qZA(),e.TgZ(41,"mat-form-field",11)(42,"mat-label"),e._uU(43,"Enabled?"),e.qZA(),e.TgZ(44,"mat-select",18),e.YNc(45,He,2,2,"mat-option",10),e.qZA()(),e.TgZ(46,"div",19)(47,"a",20),e.NdJ("click",function(){return n.back()}),e._uU(48,"CANCEL"),e.qZA(),e.TgZ(49,"button",21),e._uU(50),e.qZA()()()()()),2&r){const i=e.MAs(11);e.xp6(1),e.Q6J("formGroup",n.promoForm),e.xp6(3),e.Q6J("isNew",!1)("mediaData",null==n.mediaData?null:n.mediaData.image),e.xp6(4),e.Q6J("formControl",n.storeCtrl)("matAutocomplete",i),e.xp6(2),e.Q6J("displayWith",n.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(13,21,n.filteredStores)),e.xp6(6),e.Q6J("ngForOf",e.l5B(27,tt,e.DdM(23,Ke),e.DdM(24,ze),e.DdM(25,Xe),e.DdM(26,et))),e.xp6(1),e.Q6J("ngIf",1===n.promoForm.value.applicableType||2===n.promoForm.value.applicableType),e.xp6(1),e.Q6J("ngIf",1===n.promoForm.value.applicableType),e.xp6(1),e.Q6J("ngIf",0===n.promoForm.value.applicableType||2===n.promoForm.value.applicableType||3===n.promoForm.value.applicableType),e.xp6(1),e.Q6J("ngIf",3===n.promoForm.value.applicableType),e.xp6(5),e.Q6J("ngForOf",e.DdM(32,ot)),e.xp6(1),e.Q6J("ngIf","Single menu"===n.promoForm.value.offerType||"Single Item"===n.promoForm.value.offerType&&n.selectedStore),e.xp6(1),e.Q6J("ngIf","Single Item"===n.promoForm.value.offerType&&n.selectMenu),e.xp6(5),e.Q6J("ngForOf",e.DdM(33,nt)),e.xp6(1),e.Q6J("ngIf","One Time"===n.promoForm.value.offerPeriodType),e.xp6(1),e.Q6J("ngIf","Recurring"===n.promoForm.value.offerPeriodType),e.xp6(9),e.Q6J("ngForOf",e.WLB(36,it,e.DdM(34,rt),e.DdM(35,at))),e.xp6(4),e.Q6J("disabled",n.promoForm.invalid),e.xp6(1),e.Oqu(n.isLoading?"CHECKING...":"SAVE")}},dependencies:[s.sg,s.O5,Y.XC,U.ey,Y.ZL,y.zs,y.lW,d.KE,d.hX,d.TO,d.R9,O.Hw,J.Nt,I.gD,Q.oG,c.nW,c.wx,c.zY,c.By,c._g,u.xw,u.SQ,u.Wh,u.yH,f._Y,f.Fj,f.wV,f.JJ,f.JL,f.oH,f.sg,f.u,f.x0,f.CE,M.t,T.ft,s.Ov]})}return o})()},{path:":id/edit",component:Ne,resolve:{offer:L}}]}];let mt=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.oAB({type:o});static#o=this.\u0275inj=e.cJS({imports:[g.Bz.forChild(ft),g.Bz]})}return o})();var lt=m(1447),st=m(6005),ut=m(6208);let ct=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.oAB({type:o});static#o=this.\u0275inj=e.cJS({providers:[E,L,h,A.f,N.O],imports:[s.ez,mt,st.q,lt.o9,f.UX,f.u5,ut.m,T.EC,T.Yy,T.K]})}return o})()}}]);