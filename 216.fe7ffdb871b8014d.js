"use strict";(self.webpackChunkshopbot=self.webpackChunkshopbot||[]).push([[216],{4216:(Ee,b,f)=>{f.r(b),f.d(b,{OffersModule:()=>qe});var l=f(6814),g=f(1896),e=f(5879);let P=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-offers"]],decls:1,vars:0,template:function(t,r){1&t&&e._UZ(0,"router-outlet")},dependencies:[g.lC],encapsulation:2}),o})();var G=f(553),R=f(9862);let _=(()=>{class o{constructor(t){this._httpClient=t,this.hostServer=G.N.hostServer}getOffers(){return this._httpClient.get(`${this.hostServer}/offers`)}getOffer(t){return this._httpClient.get(`${this.hostServer}/offers/${t}`)}deleteOffer(t){return this._httpClient.delete(`${this.hostServer}/offers/${t}`)}updateOffer(t,r){return this._httpClient.put(`${this.hostServer}/offers/${t}`,r)}createOffer(t){return this._httpClient.post(`${this.hostServer}/offers`,t)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(R.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})();var O=f(7700),h=f(2296),w=f(617),A=f(7988),m=f(3814);function V(o,a){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.BQk()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.AsE(" ",e.xi3(2,2,t.startTime,"medium")," - ",e.xi3(3,5,t.endTime,"medium")," ")}}function k(o,a){1&o&&(e.ynx(0),e._uU(1," Recurring offer "),e.BQk())}const $=function(o){return["../",o,"edit"]};function H(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"tr",7)(1,"th",8),e._UZ(2,"img",9),e.TgZ(3,"div",10)(4,"div",11),e._uU(5),e.qZA(),e.TgZ(6,"div",12),e._uU(7),e.qZA()()(),e.TgZ(8,"td",13),e._uU(9),e.qZA(),e.TgZ(10,"td",13),e._uU(11),e.qZA(),e.TgZ(12,"td",13),e._uU(13),e.qZA(),e.TgZ(14,"td",13),e.YNc(15,V,4,8,"ng-container",14),e.YNc(16,k,2,0,"ng-container",14),e.qZA(),e.TgZ(17,"td",13)(18,"button",15)(19,"mat-icon"),e._uU(20,"more_vert"),e.qZA()(),e.TgZ(21,"mat-menu",null,16)(23,"button",17),e.NdJ("click",function(){const n=e.CHM(t),s=n.$implicit,T=n.index,y=e.oxw();return e.KtG(y.deleteOffer(s._id,T))}),e.TgZ(24,"mat-icon",18),e._uU(25,"delete"),e.qZA(),e.TgZ(26,"span"),e._uU(27,"Delete"),e.qZA()(),e.TgZ(28,"button",19)(29,"mat-icon",18),e._uU(30,"visibility"),e.qZA(),e.TgZ(31,"span"),e._uU(32,"Edit Offer"),e.qZA()()()()()}if(2&o){const t=a.$implicit,r=e.MAs(22);e.xp6(2),e.Q6J("src",t.image,e.LSH),e.xp6(3),e.Oqu(t.store.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",(null==t||null==t.menu?null:t.menu.name)||"Applied to all"," "),e.xp6(2),e.hij(" ",(null==t||null==t.food?null:t.food.name)||"Applied to all"," "),e.xp6(2),e.hij(" ",t.discount," "),e.xp6(2),e.Q6J("ngIf","One Time"===t.offerPeriodType),e.xp6(1),e.Q6J("ngIf","One Time"!==t.offerPeriodType),e.xp6(2),e.Q6J("matMenuTriggerFor",r),e.xp6(10),e.Q6J("routerLink",e.VKq(10,$,t._id))}}const j=function(){return["../","new-offer"]};let B=(()=>{class o{constructor(t,r,n){this.route=t,this.offerService=r,this._matDialog=n}ngOnInit(){this.offers=this.route.snapshot.data.offers}deleteOffer(t,r){this.offers.splice(r,1),this.offerService.deleteOffer(t).subscribe()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.gz),e.Y36(_),e.Y36(O.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-offers-list"]],decls:26,vars:3,consts:[[1,"relative","overflow-x-auto","shadow-md","sm:rounded-lg"],["fxLayout","row","fxLayoutAlign","space-between center",1,"p-4","bg-white"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"w-full","text-sm","text-left","text-gray-500"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50"],["scope","col",1,"px-6","py-3"],["class","bg-white border-b  hover:bg-gray-50 ",4,"ngFor","ngForOf"],[1,"bg-white","border-b","hover:bg-gray-50"],["scope","row",1,"flex","items-center","px-6","py-4","text-gray-900","whitespace-nowrap"],["alt","Jese image",1,"w-10","h-10","rounded-full",3,"src"],[1,"pl-3"],[1,"text-base","font-semibold"],[1,"font-normal","text-gray-500"],[1,"px-6","py-4"],[4,"ngIf"],["mat-icon-button","","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"material-icons-outlined"],["mat-menu-item","",3,"routerLink"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2"),e._uU(3,"Offers"),e.qZA(),e.TgZ(4,"div")(5,"button",2)(6,"mat-icon"),e._uU(7,"add"),e.qZA(),e._uU(8," Add Offers"),e.qZA()()(),e.TgZ(9,"table",3)(10,"thead",4)(11,"tr")(12,"th",5),e._uU(13," Store "),e.qZA(),e.TgZ(14,"th",5),e._uU(15," Menu "),e.qZA(),e.TgZ(16,"th",5),e._uU(17," Product "),e.qZA(),e.TgZ(18,"th",5),e._uU(19," Discount "),e.qZA(),e.TgZ(20,"th",5),e._uU(21," Duration "),e.qZA(),e.TgZ(22,"th",5),e._uU(23," Action "),e.qZA()()(),e.TgZ(24,"tbody"),e.YNc(25,H,33,12,"tr",6),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("routerLink",e.DdM(2,j)),e.xp6(20),e.Q6J("ngForOf",r.offers))},dependencies:[l.sg,l.O5,g.rH,h.lW,h.RK,w.Hw,A.VK,A.OP,A.p6,m.xw,m.Wh,l.uU]}),o})();var Z=f(6028),i=f(6223),x=f(7921),C=f(7398),F=f(6116),D=f(1803),J=f(6284),N=f(940),I=f(3680),d=f(9157),U=f(2032),L=f(8525),M=f(5986),u=f(8034),Q=f(3064),v=f(9023);const W=["customerInput"],K=["auto"],z=["storeInput"],X=["storeAuto"];function ee(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.name," ")}}function te(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function oe(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function re(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Select a menu"),e.qZA(),e.TgZ(3,"mat-select",19),e.NdJ("selectionChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.selectedMenu(n))}),e.YNc(4,oe,2,2,"mat-option",7),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("compareWith",t.objectComparisonFunction),e.xp6(1),e.Q6J("ngForOf",t.menus)}}function ne(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.name," ")}}function ae(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Select a menu Item"),e.qZA(),e.TgZ(3,"mat-select",20),e.YNc(4,ne,2,2,"mat-option",7),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.selectMenu.foods)}}function ie(o,a){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function fe(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid start date"),e.qZA())}function se(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid end date"),e.qZA())}function le(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",5)(1,"mat-label"),e._uU(2,"Offer Start/End Period"),e.qZA(),e.TgZ(3,"mat-date-range-input",21),e._UZ(4,"input",22)(5,"input",23),e.qZA(),e._UZ(6,"mat-datepicker-toggle",24)(7,"mat-date-range-picker",null,25),e.YNc(9,fe,2,0,"mat-error",26),e.YNc(10,se,2,0,"mat-error",26),e.qZA()),2&o){const t=e.MAs(8),r=e.oxw();e.xp6(3),e.Q6J("rangePicker",t),e.xp6(3),e.Q6J("for",t),e.xp6(3),e.Q6J("ngIf",r.range.controls.start.hasError("matStartDateInvalid")),e.xp6(1),e.Q6J("ngIf",r.range.controls.end.hasError("matEndDateInvalid"))}}function me(o,a){if(1&o&&(e.TgZ(0,"div",29),e.ynx(1,30),e.TgZ(2,"mat-checkbox",31),e._uU(3),e.qZA(),e._UZ(4,"ngx-mat-timepicker",32)(5,"ngx-mat-timepicker",33),e.BQk(),e.qZA()),2&o){const t=a.$implicit,r=a.index;e.xp6(1),e.Q6J("formGroupName",r),e.xp6(2),e.Oqu(t.value.day),e.xp6(1),e.Q6J("enableMeridian",!0),e.xp6(1),e.Q6J("enableMeridian",!0)}}function ue(o,a){if(1&o&&(e.TgZ(0,"div",27),e.YNc(1,me,6,4,"div",28),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.offerPeriods.controls)}}const ce=function(){return["Entire menu","Single menu","Single Item"]},de=function(){return["One Time","Recurring"]};let pe=(()=>{class o{constructor(t,r,n,s,T,y,S,c){this.fb=t,this.offersService=r,this.usersService=n,this.storesService=s,this.location=T,this.dialog=y,this.menuService=S,this.route=c,this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.separatorKeysCodes=[Z.K5,Z.OC],this.menuCtrl=new i.NI,this.storeCtrl=new i.NI,this.isLoading=!1,this.selectedCustomers=[],this.range=new i.cw({start:new i.NI(null),end:new i.NI(null)}),this.panelOpenState=!1,this.availableDays=[{day:"Sunday",active:!0,startDate:new Date,endDate:new Date},{day:"Monday",active:!0,startDate:new Date,endDate:new Date},{day:"Tuesday",active:!0,startDate:new Date,endDate:new Date},{day:"Wednesday",active:!0,startDate:new Date,endDate:new Date},{day:"Thursday",active:!0,startDate:new Date,endDate:new Date},{day:"Friday",active:!0,startDate:new Date,endDate:new Date},{day:"Saturday",active:!0,startDate:new Date,endDate:new Date}],this.filteredDays=[],this.menus=[],this.stores=[],this.offer=this.route.snapshot.data.offer,this.selectedStore=this.offer.store,this.selectMenu=this.offer.menu,this.getStores(),this.getMenu(this.selectedStore._id),this.promoForm=this.fb.group({image:[this.offer?.image],menu:[this.offer?.menu?._id],food:[this.offer?.food?._id],offerType:[this.offer?.offerType,i.kI.required],offerPeriodType:[this.offer?.offerPeriodType,i.kI.required],offerPeriodDays:this.fb.array([]),store:[this.offer?.store?._id],discount:[this.offer?.discount,i.kI.required],startTime:[this.offer?.startTime],endTime:[this.offer?.endTime],description:[this.offer?.description,i.kI.required]}),this.offer.offerPeriodDays.forEach(p=>{this.addOfferPeriods(p)}),this.mediaData={image:this.offer?.image,icon:null},this.filteredMenus=this.menuCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(p=>p?this._filter(p):this.menus.slice())),this.filteredStores=this.storeCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(p=>p?this._filterStore(p):this.stores.slice()))}addOfferPeriods(t){const r=this.fb.group({day:t.day,active:t.active,startDate:new Date(t.startDate),endDate:new Date(t.endDate)});this.offerPeriods.push(r)}get offerPeriods(){return this.promoForm.controls.offerPeriodDays}ngOnInit(){}_filter(t){if("string"==typeof t){const r=t?.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}_filterStore(t){if("string"==typeof t){const r=t?.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}displayFn(t){return t?.name}submit(){if(this.promoForm.valid){let t=this.promoForm.getRawValue();t.menu=this.selectMenu?._id,this.isLoading=!0,this.offersService.updateOffer(this.offer._id,t).subscribe(r=>{this.isLoading=!1,this.location.back()})}}objectComparisonFunction(t,r){return t.id===r.id}selectStore(t){this.getMenu(t.value)}getMenu(t){this.menuService.getStoreMenus(t).subscribe(r=>{this.menus=r})}selectedMenu(t){this.selectMenu=t.value}getStores(){this.storesService.getStores({data:{$match:{}},control:[{$sort:{createdAt:-1}}]}).subscribe(t=>{this.stores=t})}back(){this.location.back()}addMedia(t){this.dialog.open(F.R).afterClosed().subscribe(n=>{n&&(this.promoForm.patchValue({[t]:n.url}),this.mediaData[t]={[t]:n}[t])})}removeValue(t){this.promoForm.patchValue({[t]:null}),this.mediaData[t]=null}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(i.qu),e.Y36(_),e.Y36(D.f),e.Y36(J._),e.Y36(l.Ye),e.Y36(O.uw),e.Y36(N.O),e.Y36(g.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-edit-offer"]],viewQuery:function(t,r){if(1&t&&(e.Gf(W,5),e.Gf(K,5),e.Gf(z,5),e.Gf(X,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.customerInput=n.first),e.iGM(n=e.CRH())&&(r.matAutocomplete=n.first),e.iGM(n=e.CRH())&&(r.storeInput=n.first),e.iGM(n=e.CRH())&&(r.matAutocompleteStore=n.first)}},decls:39,vars:14,consts:[[1,"mat-elevation-z3","container","mx-auto","my-10","container-md","p-5"],[3,"formGroup","ngSubmit"],["fxLayout","column","fxLayoutAlign","start start"],["fxLayout","column","fxLayoutAlign","center center",1,"m-3","w-full"],["valueName","Image",3,"isNew","mediaData","removeValue","openMediaBrowser"],[1,"w-full"],["formControlName","store",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","offerType"],["class","w-full",4,"ngIf"],["formControlName","offerPeriodType"],["formArrayName","offerPeriodDays","class","w-full",4,"ngIf"],["matInput","","type","number","placeholder","Enter Discount","formControlName","discount"],["matSuffix",""],["matInput","","placeholder","Text Description","formControlName","description"],["fxLayout.gt-md","row","fxLayoutAlign.gt-md","space-around start","fxLayout.lt-lg","column","fxLayoutAlign.lt-lg","space-around stretch","fxLayoutGap","10px",1,"w-full"],["mat-raised-button","","fxFlex","50%",3,"click"],["mat-raised-button","","fxFlex","50%","color","primary",3,"disabled"],[3,"value"],["formControlName","menu",3,"compareWith","selectionChange"],["formControlName","food"],[3,"rangePicker"],["matStartDate","","formControlName","startTime","placeholder","Start date"],["matEndDate","","formControlName","endTime","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],[4,"ngIf"],["formArrayName","offerPeriodDays",1,"w-full"],["class","p-3 border-b-2 border-b-gray w-full","fxLayout","row","fxLayoutAlign","space-around center",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-around center",1,"p-3","border-b-2","border-b-gray","w-full"],[3,"formGroupName"],["formControlName","active"],["formControlName","startDate",3,"enableMeridian"],["formControlName","endDate",3,"enableMeridian"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return r.submit()}),e.TgZ(2,"div",2)(3,"div",3)(4,"app-select-media",4),e.NdJ("removeValue",function(s){return r.removeValue(s)})("openMediaBrowser",function(s){return r.addMedia(s)}),e.qZA()(),e.TgZ(5,"mat-form-field",5)(6,"mat-label"),e._uU(7,"Select a vendor"),e.qZA(),e.TgZ(8,"mat-select",6),e.NdJ("selectionChange",function(s){return r.selectStore(s)}),e.YNc(9,ee,2,2,"mat-option",7),e.qZA()(),e.TgZ(10,"mat-form-field",5)(11,"mat-label"),e._uU(12,"Offer Type"),e.qZA(),e.TgZ(13,"mat-select",8),e.YNc(14,te,2,2,"mat-option",7),e.qZA()(),e.YNc(15,re,5,2,"mat-form-field",9),e.YNc(16,ae,5,1,"mat-form-field",9),e.TgZ(17,"mat-form-field",5)(18,"mat-label"),e._uU(19,"Offer Period Type"),e.qZA(),e.TgZ(20,"mat-select",10),e.YNc(21,ie,2,2,"mat-option",7),e.qZA()(),e.YNc(22,le,11,4,"mat-form-field",9),e.YNc(23,ue,2,1,"div",11),e.TgZ(24,"mat-form-field",5)(25,"mat-label"),e._uU(26,"Discount"),e.qZA(),e._UZ(27,"input",12),e.TgZ(28,"mat-icon",13),e._uU(29,"percent"),e.qZA()(),e.TgZ(30,"mat-form-field",5)(31,"mat-label"),e._uU(32,"Description"),e.qZA(),e._UZ(33,"textarea",14),e.qZA(),e.TgZ(34,"div",15)(35,"a",16),e.NdJ("click",function(){return r.back()}),e._uU(36,"CANCEL"),e.qZA(),e.TgZ(37,"button",17),e._uU(38),e.qZA()()()()()),2&t&&(e.xp6(1),e.Q6J("formGroup",r.promoForm),e.xp6(3),e.Q6J("isNew",!1)("mediaData",null==r.mediaData?null:r.mediaData.image),e.xp6(5),e.Q6J("ngForOf",r.stores),e.xp6(5),e.Q6J("ngForOf",e.DdM(12,ce)),e.xp6(1),e.Q6J("ngIf","Single menu"===r.promoForm.value.offerType||"Single Item"===r.promoForm.value.offerType&&r.selectedStore),e.xp6(1),e.Q6J("ngIf","Single Item"===r.promoForm.value.offerType&&r.selectMenu),e.xp6(5),e.Q6J("ngForOf",e.DdM(13,de)),e.xp6(1),e.Q6J("ngIf","One Time"===r.promoForm.value.offerPeriodType),e.xp6(1),e.Q6J("ngIf","Recurring"===r.promoForm.value.offerPeriodType),e.xp6(14),e.Q6J("disabled",r.promoForm.invalid),e.xp6(1),e.Oqu(r.isLoading?"CHECKING...":"SAVE"))},dependencies:[l.sg,l.O5,I.ey,h.zs,h.lW,d.KE,d.hX,d.TO,d.R9,w.Hw,U.Nt,L.gD,M.oG,u.nW,u.wx,u.zY,u.By,u._g,m.xw,m.SQ,m.Wh,m.yH,i._Y,i.Fj,i.wV,i.JJ,i.JL,i.sg,i.u,i.x0,i.CE,Q.t,v.ft]}),o})(),q=(()=>{class o{constructor(t){this.offersService=t}resolve(){return this.offersService.getOffers()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(_))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),E=(()=>{class o{constructor(t){this.offerService=t}resolve(t){const r=t.paramMap.get("id");return this.offerService.getOffer(r)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(_))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var Y=f(4630);const ge=["customerInput"],_e=["auto"],he=["storeInput"],ve=["storeAuto"];function Te(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function ye(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function Ze(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function xe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Select a menu"),e.qZA(),e._UZ(3,"input",23,24),e.TgZ(5,"mat-autocomplete",8,25),e.NdJ("optionSelected",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.selectedMenu(n))}),e.YNc(7,Ze,2,2,"mat-option",10),e.ALo(8,"async"),e.qZA()()}if(2&o){const t=e.MAs(6),r=e.oxw();e.xp6(3),e.Q6J("formControl",r.menuCtrl)("matAutocomplete",t),e.xp6(2),e.Q6J("displayWith",r.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,4,r.filteredMenus))}}function Ce(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.name," ")}}function Oe(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Select a menu Item"),e.qZA(),e.TgZ(3,"mat-select",26),e.YNc(4,Ce,2,2,"mat-option",10),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.selectMenu.foods)}}function we(o,a){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function Ae(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid start date"),e.qZA())}function De(o,a){1&o&&(e.TgZ(0,"mat-error"),e._uU(1,"Invalid end date"),e.qZA())}function Ne(o,a){if(1&o&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Offer Start/End Period"),e.qZA(),e.TgZ(3,"mat-date-range-input",27),e._UZ(4,"input",28)(5,"input",29),e.qZA(),e._UZ(6,"mat-datepicker-toggle",30)(7,"mat-date-range-picker",null,31),e.YNc(9,Ae,2,0,"mat-error",32),e.YNc(10,De,2,0,"mat-error",32),e.qZA()),2&o){const t=e.MAs(8),r=e.oxw();e.xp6(3),e.Q6J("rangePicker",t),e.xp6(3),e.Q6J("for",t),e.xp6(3),e.Q6J("ngIf",r.range.controls.start.hasError("matStartDateInvalid")),e.xp6(1),e.Q6J("ngIf",r.range.controls.end.hasError("matEndDateInvalid"))}}function Se(o,a){if(1&o&&(e.TgZ(0,"div",35),e.ynx(1,36),e.TgZ(2,"mat-checkbox",37),e._uU(3),e.qZA(),e._UZ(4,"ngx-mat-timepicker",38)(5,"ngx-mat-timepicker",39),e.BQk(),e.qZA()),2&o){const t=a.$implicit,r=a.index;e.xp6(1),e.Q6J("formGroupName",r),e.xp6(2),e.Oqu(t.value.day),e.xp6(1),e.Q6J("enableMeridian",!0),e.xp6(1),e.Q6J("enableMeridian",!0)}}function be(o,a){if(1&o&&(e.TgZ(0,"div",33),e.YNc(1,Se,6,4,"div",34),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.offerPeriods.controls)}}const Fe=function(){return["Entire menu","Single menu","Single Item"]},Je=function(){return["One Time","Recurring"]},Ie=[{path:"",component:P,children:[{path:"list",component:B,resolve:{offers:q}},{path:"new-offer",component:(()=>{class o{constructor(t,r,n,s,T,y,S){this.fb=t,this.offersService=r,this.usersService=n,this.storesService=s,this.location=T,this.dialog=y,this.menuService=S,this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.separatorKeysCodes=[Z.K5,Z.OC],this.menuCtrl=new i.NI,this.storeCtrl=new i.NI,this.isLoading=!1,this.selectedCustomers=[],this.range=new i.cw({start:new i.NI(null),end:new i.NI(null)}),this.panelOpenState=!1,this.availableDays=[{day:"Sunday",active:!0,startDate:new Date,endDate:new Date},{day:"Monday",active:!0,startDate:new Date,endDate:new Date},{day:"Tuesday",active:!0,startDate:new Date,endDate:new Date},{day:"Wednesday",active:!0,startDate:new Date,endDate:new Date},{day:"Thursday",active:!0,startDate:new Date,endDate:new Date},{day:"Friday",active:!0,startDate:new Date,endDate:new Date},{day:"Saturday",active:!0,startDate:new Date,endDate:new Date}],this.filteredDays=[],this.menus=[],this.stores=[],this.promoForm=this.fb.group({image:[""],menu:[null],food:[null],offerType:["",i.kI.required],offerPeriodType:["",i.kI.required],offerPeriodDays:this.fb.array([]),store:[""],discount:[0,i.kI.required],startTime:[this.range.value.start],endTime:[this.range.value.end],description:["",i.kI.required]}),this.availableDays.forEach(c=>{this.addOfferPeriods(c)}),this.getStores(),this.mediaData={image:null,icon:null},this.filteredMenus=this.menuCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(c=>c?this._filter(c):this.menus.slice())),this.filteredStores=this.storeCtrl.valueChanges.pipe((0,x.O)(null),(0,C.U)(c=>c?this._filterStore(c):this.stores.slice()))}addOfferPeriods(t){const r=this.fb.group({day:t.day,active:t.active,startDate:t.startDate,endDate:t.endDate});this.offerPeriods.push(r)}get offerPeriods(){return this.promoForm.controls.offerPeriodDays}ngOnInit(){}_filter(t){if("string"==typeof t){const r=t?.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.menus?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}_filterStore(t){if("string"==typeof t){const r=t?.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}{const r=t.name.toLowerCase();return this.stores?.filter(n=>0===n?.name?.toLowerCase().indexOf(r))}}displayFn(t){return t?.name}submit(){if(this.promoForm.valid){let t=this.promoForm.getRawValue();t.store=this.selectedStore._id,t.menu=this.selectMenu?._id,this.isLoading=!0,this.offersService.createOffer(t).subscribe(r=>{this.isLoading=!1,this.location.back()})}}selectStore(t){this.selectedStore=t.option.value,setTimeout(()=>{this.getMenu()},2e3)}getMenu(){this.selectedStore&&this.menuService.getStoreMenus(this.selectedStore._id).subscribe(t=>{this.menus=t})}selectedMenu(t){this.selectMenu=t.option.value}getStores(){this.storesService.getStores({data:{$match:{}},control:[{$sort:{createdAt:-1}}]}).subscribe(t=>{this.stores=t})}back(){this.location.back()}addMedia(t){this.dialog.open(F.R).afterClosed().subscribe(n=>{n&&(this.promoForm.patchValue({[t]:n.url}),this.mediaData[t]={[t]:n}[t])})}removeValue(t){this.promoForm.patchValue({[t]:null}),this.mediaData[t]=null}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(i.qu),e.Y36(_),e.Y36(D.f),e.Y36(J._),e.Y36(l.Ye),e.Y36(O.uw),e.Y36(N.O))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-new-offer"]],viewQuery:function(t,r){if(1&t&&(e.Gf(ge,5),e.Gf(_e,5),e.Gf(he,5),e.Gf(ve,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.customerInput=n.first),e.iGM(n=e.CRH())&&(r.matAutocomplete=n.first),e.iGM(n=e.CRH())&&(r.storeInput=n.first),e.iGM(n=e.CRH())&&(r.matAutocompleteStore=n.first)}},decls:43,vars:19,consts:[[1,"mat-elevation-z3","container","mx-auto","my-10","container-md","p-5"],[3,"formGroup","ngSubmit"],["fxLayout","column","fxLayoutAlign","start start"],["fxLayout","column","fxLayoutAlign","center center",1,"m-3","w-full"],["valueName","Image",3,"isNew","mediaData","removeValue","openMediaBrowser"],["fxFlex.gt-md","50%","fxFlex.lt-lg","100%",1,"w-full"],["matInput","","placeholder","Select a vendor","formControlName","store",3,"formControl","matAutocomplete"],["storeInput",""],[3,"displayWith","optionSelected"],["storeAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full"],["formControlName","offerType"],["class","w-full",4,"ngIf"],["formControlName","offerPeriodType"],["formArrayName","offerPeriodDays","class","w-full",4,"ngIf"],["matInput","","type","number","placeholder","Enter Discount","formControlName","discount"],["matSuffix",""],["matInput","","placeholder","Text Description","formControlName","description"],["fxLayout.gt-md","row","fxLayoutAlign.gt-md","space-around start","fxLayout.lt-lg","column","fxLayoutAlign.lt-lg","space-around stretch","fxLayoutGap","10px",1,"w-full"],["mat-raised-button","","fxFlex","50%",3,"click"],["mat-raised-button","","fxFlex","50%","color","primary",3,"disabled"],[3,"value"],["matInput","","placeholder","Select a menu","formControlName","menu",3,"formControl","matAutocomplete"],["menuInput",""],["menuAuto","matAutocomplete"],["formControlName","food"],[3,"rangePicker"],["matStartDate","","formControlName","startTime","placeholder","Start date"],["matEndDate","","formControlName","endTime","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],[4,"ngIf"],["formArrayName","offerPeriodDays",1,"w-full"],["class","p-3 border-b-2 border-b-gray w-full","fxLayout","row","fxLayoutAlign","space-around center",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-around center",1,"p-3","border-b-2","border-b-gray","w-full"],[3,"formGroupName"],["formControlName","active"],["formControlName","startDate",3,"enableMeridian"],["formControlName","endDate",3,"enableMeridian"]],template:function(t,r){if(1&t&&(e.TgZ(0,"div",0)(1,"form",1),e.NdJ("ngSubmit",function(){return r.submit()}),e.TgZ(2,"div",2)(3,"div",3)(4,"app-select-media",4),e.NdJ("removeValue",function(s){return r.removeValue(s)})("openMediaBrowser",function(s){return r.addMedia(s)}),e.qZA()(),e.TgZ(5,"mat-form-field",5)(6,"mat-label"),e._uU(7,"Select a vendor"),e.qZA(),e._UZ(8,"input",6,7),e.TgZ(10,"mat-autocomplete",8,9),e.NdJ("optionSelected",function(s){return r.selectStore(s)}),e.YNc(12,Te,2,2,"mat-option",10),e.ALo(13,"async"),e.qZA()(),e.TgZ(14,"mat-form-field",11)(15,"mat-label"),e._uU(16,"Offer Type"),e.qZA(),e.TgZ(17,"mat-select",12),e.YNc(18,ye,2,2,"mat-option",10),e.qZA()(),e.YNc(19,xe,9,6,"mat-form-field",13),e.YNc(20,Oe,5,1,"mat-form-field",13),e.TgZ(21,"mat-form-field",11)(22,"mat-label"),e._uU(23,"Offer Period Type"),e.qZA(),e.TgZ(24,"mat-select",14),e.YNc(25,we,2,2,"mat-option",10),e.qZA()(),e.YNc(26,Ne,11,4,"mat-form-field",13),e.YNc(27,be,2,1,"div",15),e.TgZ(28,"mat-form-field",11)(29,"mat-label"),e._uU(30,"Discount"),e.qZA(),e._UZ(31,"input",16),e.TgZ(32,"mat-icon",17),e._uU(33,"percent"),e.qZA()(),e.TgZ(34,"mat-form-field",11)(35,"mat-label"),e._uU(36,"Description"),e.qZA(),e._UZ(37,"textarea",18),e.qZA(),e.TgZ(38,"div",19)(39,"a",20),e.NdJ("click",function(){return r.back()}),e._uU(40,"CANCEL"),e.qZA(),e.TgZ(41,"button",21),e._uU(42),e.qZA()()()()()),2&t){const n=e.MAs(11);e.xp6(1),e.Q6J("formGroup",r.promoForm),e.xp6(3),e.Q6J("isNew",!1)("mediaData",null==r.mediaData?null:r.mediaData.image),e.xp6(4),e.Q6J("formControl",r.storeCtrl)("matAutocomplete",n),e.xp6(2),e.Q6J("displayWith",r.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(13,15,r.filteredStores)),e.xp6(6),e.Q6J("ngForOf",e.DdM(17,Fe)),e.xp6(1),e.Q6J("ngIf","Single menu"===r.promoForm.value.offerType||"Single Item"===r.promoForm.value.offerType&&r.selectedStore),e.xp6(1),e.Q6J("ngIf","Single Item"===r.promoForm.value.offerType&&r.selectMenu),e.xp6(5),e.Q6J("ngForOf",e.DdM(18,Je)),e.xp6(1),e.Q6J("ngIf","One Time"===r.promoForm.value.offerPeriodType),e.xp6(1),e.Q6J("ngIf","Recurring"===r.promoForm.value.offerPeriodType),e.xp6(14),e.Q6J("disabled",r.promoForm.invalid),e.xp6(1),e.Oqu(r.isLoading?"CHECKING...":"SAVE")}},dependencies:[l.sg,l.O5,Y.XC,I.ey,Y.ZL,h.zs,h.lW,d.KE,d.hX,d.TO,d.R9,w.Hw,U.Nt,L.gD,M.oG,u.nW,u.wx,u.zY,u.By,u._g,m.xw,m.SQ,m.Wh,m.yH,i._Y,i.Fj,i.wV,i.JJ,i.JL,i.oH,i.sg,i.u,i.x0,i.CE,Q.t,v.ft,l.Ov]}),o})()},{path:":id/edit",component:pe,resolve:{offer:E}}]}];let Ue=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[g.Bz.forChild(Ie),g.Bz]}),o})();var Le=f(1447),Me=f(6005),Qe=f(6208);let qe=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[q,E,_,D.f,N.O],imports:[l.ez,Ue,Me.q,Le.o9,i.UX,i.u5,Qe.m,v.EC,v.Yy,v.K]}),o})()}}]);