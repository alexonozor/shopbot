"use strict";(self.webpackChunkshopbot=self.webpackChunkshopbot||[]).push([[4053],{4053:(dt,G,f)=>{f.r(G),f.d(G,{OffersModule:()=>ut});var l=f(177),F=f(8498),e=f(3953);let A=(()=>{class o{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-offers"]],decls:1,vars:0,template:function(n,r){1&n&&e.nrm(0,"router-outlet")},dependencies:[F.n3],encapsulation:2})}return o})();var J=f(5312),P=f(1626);let g=(()=>{class o{constructor(t){this._httpClient=t,this.hostServer=J.c.hostServer}getOffers(){return this._httpClient.get(`${this.hostServer}/offers`)}getOffer(t){return this._httpClient.get(`${this.hostServer}/offers/${t}`)}deleteOffer(t){return this._httpClient.delete(`${this.hostServer}/offers/${t}`)}updateOffer(t,n){return this._httpClient.put(`${this.hostServer}/offers/${t}`,n)}createOffer(t){return this._httpClient.post(`${this.hostServer}/offers`,t)}static#e=this.\u0275fac=function(n){return new(n||o)(e.KVO(P.Qq))};static#t=this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}return o})();var D=f(5351),v=f(8834),T=f(9213),O=f(9115),u=f(2920);const B=()=>["../","new-offer"],X=o=>["../",o,"edit"];function U(o,a){if(1&o&&(e.qex(0),e.EFF(1),e.nI1(2,"date"),e.nI1(3,"date"),e.bVm()),2&o){const t=e.XpG().$implicit;e.R7$(),e.Lme(" ",e.i5U(2,2,t.startTime,"medium")," - ",e.i5U(3,5,t.endTime,"medium")," ")}}function W(o,a){1&o&&(e.qex(0),e.EFF(1," Recurring offer "),e.bVm())}function K(o,a){if(1&o){const t=e.RV6();e.j41(0,"tr",8)(1,"th",9),e.nrm(2,"img",10),e.j41(3,"div",11)(4,"div",12),e.EFF(5),e.k0s(),e.j41(6,"div",13),e.EFF(7),e.k0s()()(),e.j41(8,"td",14),e.EFF(9),e.k0s(),e.j41(10,"td",14),e.EFF(11),e.k0s(),e.j41(12,"td",14),e.EFF(13),e.k0s(),e.j41(14,"td",14),e.DNE(15,U,4,8,"ng-container",15)(16,W,2,0,"ng-container",15),e.k0s(),e.j41(17,"td",14)(18,"button",16)(19,"mat-icon"),e.EFF(20,"more_vert"),e.k0s()(),e.j41(21,"mat-menu",null,0)(23,"button",17),e.bIt("click",function(){const r=e.eBV(t),i=r.$implicit,m=r.index,c=e.XpG();return e.Njj(c.deleteOffer(i._id,m))}),e.j41(24,"mat-icon",18),e.EFF(25,"delete"),e.k0s(),e.j41(26,"span"),e.EFF(27,"Delete"),e.k0s()(),e.j41(28,"button",19)(29,"mat-icon",18),e.EFF(30,"visibility"),e.k0s(),e.j41(31,"span"),e.EFF(32,"Edit Offer"),e.k0s()()()()()}if(2&o){const t=a.$implicit,n=e.sdS(22);e.R7$(2),e.Y8G("src",t.image,e.B4B),e.R7$(3),e.JRh(t.store.name),e.R7$(2),e.JRh(t.description),e.R7$(2),e.SpI(" ",(null==t||null==t.menu?null:t.menu.name)||"Applied to all"," "),e.R7$(2),e.SpI(" ",(null==t||null==t.food?null:t.food.name)||"Applied to all"," "),e.R7$(2),e.SpI(" ",t.discount," "),e.R7$(2),e.Y8G("ngIf","One Time"===t.offerPeriodType),e.R7$(),e.Y8G("ngIf","One Time"!==t.offerPeriodType),e.R7$(2),e.Y8G("matMenuTriggerFor",n),e.R7$(10),e.Y8G("routerLink",e.eq3(10,X,t._id))}}let Z=(()=>{class o{constructor(t,n,r){this.route=t,this.offerService=n,this._matDialog=r}ngOnInit(){this.offers=this.route.snapshot.data.offers}deleteOffer(t,n){this.offers.splice(n,1),this.offerService.deleteOffer(t).subscribe()}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(F.nX),e.rXU(g),e.rXU(D.bZ))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-offers-list"]],decls:26,vars:3,consts:[["menu","matMenu"],[1,"relative","overflow-x-auto","shadow-md","sm:rounded-lg"],["fxLayout","row","fxLayoutAlign","space-between center",1,"p-4","bg-white"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"w-full","text-sm","text-left","text-gray-500"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50"],["scope","col",1,"px-6","py-3"],["class","bg-white border-b  hover:bg-gray-50 ",4,"ngFor","ngForOf"],[1,"bg-white","border-b","hover:bg-gray-50"],["scope","row",1,"flex","items-center","px-6","py-4","text-gray-900","whitespace-nowrap"],["alt","Jese image",1,"w-10","h-10","rounded-full",3,"src"],[1,"pl-3"],[1,"text-base","font-semibold"],[1,"font-normal","text-gray-500"],[1,"px-6","py-4"],[4,"ngIf"],["mat-icon-button","","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"material-icons-outlined"],["mat-menu-item","",3,"routerLink"]],template:function(n,r){1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"h2"),e.EFF(3,"Offers"),e.k0s(),e.j41(4,"div")(5,"button",3)(6,"mat-icon"),e.EFF(7,"add"),e.k0s(),e.EFF(8," Add Offers"),e.k0s()()(),e.j41(9,"table",4)(10,"thead",5)(11,"tr")(12,"th",6),e.EFF(13," Store "),e.k0s(),e.j41(14,"th",6),e.EFF(15," Menu "),e.k0s(),e.j41(16,"th",6),e.EFF(17," Product "),e.k0s(),e.j41(18,"th",6),e.EFF(19," Discount "),e.k0s(),e.j41(20,"th",6),e.EFF(21," Duration "),e.k0s(),e.j41(22,"th",6),e.EFF(23," Action "),e.k0s()()(),e.j41(24,"tbody"),e.DNE(25,K,33,12,"tr",7),e.k0s()()()),2&n&&(e.R7$(5),e.Y8G("routerLink",e.lJ4(2,B)),e.R7$(20),e.Y8G("ngForOf",r.offers))},dependencies:[l.Sq,l.bT,F.Wk,v.$z,v.iY,T.An,O.kk,O.fb,O.Cp,u.DJ,u.sA,l.vh]})}return o})();var b=f(7336),s=f(9417),E=f(9172),C=f(6354),$=f(2264),w=f(2382),j=f(5117),k=f(2390),I=f(6600),h=f(3719),N=f(9631),R=f(2798),x=f(2765),d=f(5084),Y=f(801),y=f(8910);const z=["customerInput"],Q=["auto"],q=["storeInput"],H=["storeAuto"],ee=()=>({name:"Discount",value:0}),te=()=>({name:"Buy x get x free",value:1}),oe=()=>({name:"Buy x, Get %(x) Off",value:2}),re=()=>({name:"%(x) Off, up to (x) amount of order",value:3}),ne=(o,a,t,n)=>[o,a,t,n],ae=()=>["Entire menu","Single menu","Single Item"],ie=()=>["One Time","Recurring"],se=()=>({name:"Enable",value:!0}),fe=()=>({name:"Disable",value:!1}),me=(o,a)=>[o,a];function le(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t._id),e.R7$(),e.SpI(" ",t.name," ")}}function ce(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.name," ")}}function ue(o,a){1&o&&(e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Enter the quantity the buyer needs to order"),e.k0s(),e.nrm(3,"input",20),e.k0s())}function de(o,a){1&o&&(e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Enter to the quantity the buy will receive"),e.k0s(),e.nrm(3,"input",21),e.k0s())}function pe(o,a){1&o&&(e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Enter the discount"),e.k0s(),e.nrm(3,"input",22),e.j41(4,"mat-icon",23),e.EFF(5,"percent"),e.k0s()())}function he(o,a){1&o&&(e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Enter the amount the user have to order"),e.k0s(),e.nrm(3,"input",24),e.j41(4,"mat-icon",23),e.EFF(5,"money"),e.k0s()())}function _e(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function Fe(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.name," ")}}function ge(o,a){if(1&o){const t=e.RV6();e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Select a menu"),e.k0s(),e.j41(3,"mat-select",25),e.bIt("selectionChange",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedMenu(r))}),e.DNE(4,Fe,2,2,"mat-option",8),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(3),e.Y8G("compareWith",t.objectComparisonFunction),e.R7$(),e.Y8G("ngForOf",t.menus)}}function ve(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t._id),e.R7$(),e.SpI(" ",t.name," ")}}function ye(o,a){if(1&o&&(e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Select a menu Item"),e.k0s(),e.j41(3,"mat-select",26),e.DNE(4,ve,2,2,"mat-option",8),e.k0s()()),2&o){const t=e.XpG();e.R7$(4),e.Y8G("ngForOf",t.selectMenu.foods)}}function be(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function Ee(o,a){1&o&&(e.j41(0,"mat-error"),e.EFF(1,"Invalid start date"),e.k0s())}function Ce(o,a){1&o&&(e.j41(0,"mat-error"),e.EFF(1,"Invalid end date"),e.k0s())}function De(o,a){if(1&o&&(e.j41(0,"mat-form-field",6)(1,"mat-label"),e.EFF(2,"Offer Start/End Period"),e.k0s(),e.j41(3,"mat-date-range-input",27),e.nrm(4,"input",28)(5,"input",29),e.k0s(),e.nrm(6,"mat-datepicker-toggle",30)(7,"mat-date-range-picker",null,0),e.DNE(9,Ee,2,0,"mat-error",31)(10,Ce,2,0,"mat-error",31),e.k0s()),2&o){const t=e.sdS(8),n=e.XpG();e.R7$(3),e.Y8G("rangePicker",t),e.R7$(3),e.Y8G("for",t),e.R7$(3),e.Y8G("ngIf",n.range.controls.start.hasError("matStartDateInvalid")),e.R7$(),e.Y8G("ngIf",n.range.controls.end.hasError("matEndDateInvalid"))}}function Te(o,a){if(1&o&&(e.j41(0,"div",34),e.qex(1,35),e.j41(2,"mat-checkbox",36),e.EFF(3),e.k0s(),e.nrm(4,"ngx-mat-timepicker",37)(5,"ngx-mat-timepicker",38),e.bVm(),e.k0s()),2&o){const t=a.$implicit,n=a.index;e.R7$(),e.Y8G("formGroupName",n),e.R7$(2),e.JRh(t.value.day),e.R7$(),e.Y8G("enableMeridian",!0),e.R7$(),e.Y8G("enableMeridian",!0)}}function Oe(o,a){if(1&o&&(e.j41(0,"div",32),e.DNE(1,Te,6,4,"div",33),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.offerPeriods.controls)}}function we(o,a){if(1&o&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.name," ")}}let ke=(()=>{class o{constructor(t,n,r,i,m,c,S,p){this.fb=t,this.offersService=n,this.usersService=r,this.storesService=i,this.location=m,this.dialog=c,this.menuService=S,this.route=p,this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.separatorKeysCodes=[b.Fm,b.KE],this.menuCtrl=new s.MJ,this.storeCtrl=new s.MJ,this.isLoading=!1,this.selectedCustomers=[],this.range=new s.gE({start:new s.MJ(null),end:new s.MJ(null)}),this.panelOpenState=!1,this.availableDays=[{day:"Sunday",active:!0,startDate:new Date,endDate:new Date},{day:"Monday",active:!0,startDate:new Date,endDate:new Date},{day:"Tuesday",active:!0,startDate:new Date,endDate:new Date},{day:"Wednesday",active:!0,startDate:new Date,endDate:new Date},{day:"Thursday",active:!0,startDate:new Date,endDate:new Date},{day:"Friday",active:!0,startDate:new Date,endDate:new Date},{day:"Saturday",active:!0,startDate:new Date,endDate:new Date}],this.filteredDays=[],this.menus=[],this.stores=[],this.offer=this.route.snapshot.data.offer,this.selectedStore=this.offer.store,this.selectMenu=this.offer.menu,this.getStores(),this.getMenu(this.selectedStore._id),this.promoForm=this.fb.group({image:[this.offer?.image],menu:[this.offer?.menu?._id],applicableType:[this.offer?.applicableType],quantityForFree:[this.offer?.quantityForFree],quantityToOrder:[this.offer?.quantityToOrder],food:[this.offer?.food?._id],offerType:[this.offer?.offerType,s.k0.required],offerPeriodType:[this.offer?.offerPeriodType,s.k0.required],offerPeriodDays:this.fb.array([]),store:[this.offer?.store?._id],amount:[this.offer?.amount],discount:[this.offer?.discount],startTime:[this.offer?.startTime],endTime:[this.offer?.endTime],enabled:[this.offer?.enabled],description:[this.offer?.description,s.k0.required]}),this.offer.offerPeriodDays.forEach(_=>{this.addOfferPeriods(_)}),this.mediaData={image:this.offer?.image,icon:null},this.filteredMenus=this.menuCtrl.valueChanges.pipe((0,E.Z)(null),(0,C.T)(_=>_?this._filter(_):this.menus.slice())),this.filteredStores=this.storeCtrl.valueChanges.pipe((0,E.Z)(null),(0,C.T)(_=>_?this._filterStore(_):this.stores.slice()))}addOfferPeriods(t){const n=this.fb.group({day:t.day,active:t.active,startDate:new Date(t.startDate),endDate:new Date(t.endDate)});this.offerPeriods.push(n)}get offerPeriods(){return this.promoForm.controls.offerPeriodDays}ngOnInit(){}_filter(t){if("string"==typeof t){const n=t?.toLowerCase();return this.menus?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}{const n=t.name.toLowerCase();return this.menus?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}}_filterStore(t){if("string"==typeof t){const n=t?.toLowerCase();return this.stores?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}{const n=t.name.toLowerCase();return this.stores?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}}displayFn(t){return t?.name}submit(){if(this.promoForm.valid){let t=this.promoForm.getRawValue();t.menu=this.selectMenu?._id,this.isLoading=!0,this.offersService.updateOffer(this.offer._id,t).subscribe(n=>{this.isLoading=!1,this.location.back()})}}objectComparisonFunction(t,n){return t.id===n.id}selectStore(t){this.getMenu(t.value)}getMenu(t){this.menuService.getStoreMenus(t).subscribe(n=>{this.menus=n})}selectedMenu(t){this.selectMenu=t.value}getStores(){this.storesService.getStores({data:{$match:{}},control:[{$sort:{createdAt:-1}}]}).subscribe(t=>{this.stores=t})}back(){this.location.back()}addMedia(t){this.dialog.open($.w).afterClosed().subscribe(r=>{r&&(this.promoForm.patchValue({[t]:r.url}),this.mediaData[t]={[t]:r}[t])})}removeValue(t){this.promoForm.patchValue({[t]:null}),this.mediaData[t]=null}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(s.ok),e.rXU(g),e.rXU(w.g),e.rXU(j.a),e.rXU(l.aZ),e.rXU(D.bZ),e.rXU(k.g),e.rXU(F.nX))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-edit-offer"]],viewQuery:function(n,r){if(1&n&&(e.GBs(z,5),e.GBs(Q,5),e.GBs(q,5),e.GBs(H,5)),2&n){let i;e.mGM(i=e.lsd())&&(r.customerInput=i.first),e.mGM(i=e.lsd())&&(r.matAutocomplete=i.first),e.mGM(i=e.lsd())&&(r.storeInput=i.first),e.mGM(i=e.lsd())&&(r.matAutocompleteStore=i.first)}},decls:47,vars:34,consts:[["picker",""],[1,"mat-elevation-z3","container","mx-auto","my-10","container-md","p-5"],[3,"ngSubmit","formGroup"],["fxLayout","column","fxLayoutAlign","start start"],["fxLayout","column","fxLayoutAlign","center center",1,"m-3","w-full"],["valueName","Image",3,"removeValue","openMediaBrowser","isNew","mediaData"],[1,"w-full"],["formControlName","store",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","applicableType"],["class","w-full",4,"ngIf"],["formControlName","offerType"],["formControlName","offerPeriodType"],["formArrayName","offerPeriodDays","class","w-full",4,"ngIf"],["matInput","","cancellation","Text Description","formControlName","description"],["formControlName","enabled"],["fxLayout.gt-md","row","fxLayoutAlign.gt-md","space-around start","fxLayout.lt-lg","column","fxLayoutAlign.lt-lg","space-around stretch","fxLayoutGap","10px",1,"w-full"],["mat-raised-button","","fxFlex","50%",3,"click"],["mat-raised-button","","fxFlex","50%","color","primary",3,"disabled"],[3,"value"],["matInput","","type","number","cancellation","Enter the quantity the buyer needs to order","formControlName","quantityToOrder"],["matInput","","type","number","cancellation","Enter to the quantity the buyer will receive","formControlName","quantityForFree"],["matInput","","type","number","cancellation","Enter Discount","formControlName","discount"],["matSuffix",""],["matInput","","type","number","cancellation","Enter the amount the user have to order","formControlName","amount"],["formControlName","menu",3,"selectionChange","compareWith"],["formControlName","food"],[3,"rangePicker"],["matStartDate","","formControlName","startTime","placeholder","Start date"],["matEndDate","","formControlName","endTime","placeholder","End date"],["matSuffix","",3,"for"],[4,"ngIf"],["formArrayName","offerPeriodDays",1,"w-full"],["class","p-3 border-b-2 border-b-gray w-full","fxLayout","row","fxLayoutAlign","space-around center",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-around center",1,"p-3","border-b-2","border-b-gray","w-full"],[3,"formGroupName"],["formControlName","active"],["formControlName","startDate",3,"enableMeridian"],["formControlName","endDate",3,"enableMeridian"]],template:function(n,r){1&n&&(e.j41(0,"div",1)(1,"form",2),e.bIt("ngSubmit",function(){return r.submit()}),e.j41(2,"div",3)(3,"div",4)(4,"app-select-media",5),e.bIt("removeValue",function(m){return r.removeValue(m)})("openMediaBrowser",function(m){return r.addMedia(m)}),e.k0s()(),e.j41(5,"mat-form-field",6)(6,"mat-label"),e.EFF(7,"Select a vendor"),e.k0s(),e.j41(8,"mat-select",7),e.bIt("selectionChange",function(m){return r.selectStore(m)}),e.DNE(9,le,2,2,"mat-option",8),e.k0s()(),e.j41(10,"mat-form-field",6)(11,"mat-label"),e.EFF(12,"What kind of offer do you want create?"),e.k0s(),e.j41(13,"mat-select",9),e.DNE(14,ce,2,2,"mat-option",8),e.k0s()(),e.DNE(15,ue,4,0,"mat-form-field",10)(16,de,4,0,"mat-form-field",10)(17,pe,6,0,"mat-form-field",10)(18,he,6,0,"mat-form-field",10),e.j41(19,"mat-form-field",6)(20,"mat-label"),e.EFF(21,"Where do you want to apply this offer?"),e.k0s(),e.j41(22,"mat-select",11),e.DNE(23,_e,2,2,"mat-option",8),e.k0s()(),e.DNE(24,ge,5,2,"mat-form-field",10)(25,ye,5,1,"mat-form-field",10),e.j41(26,"mat-form-field",6)(27,"mat-label"),e.EFF(28,"Offer Period Type"),e.k0s(),e.j41(29,"mat-select",12),e.DNE(30,be,2,2,"mat-option",8),e.k0s()(),e.DNE(31,De,11,4,"mat-form-field",10)(32,Oe,2,1,"div",13),e.j41(33,"mat-form-field",6)(34,"mat-label"),e.EFF(35,"Description"),e.k0s(),e.nrm(36,"textarea",14),e.k0s(),e.j41(37,"mat-form-field",6)(38,"mat-label"),e.EFF(39,"Enabled?"),e.k0s(),e.j41(40,"mat-select",15),e.DNE(41,we,2,2,"mat-option",8),e.k0s()(),e.j41(42,"div",16)(43,"a",17),e.bIt("click",function(){return r.back()}),e.EFF(44,"CANCEL"),e.k0s(),e.j41(45,"button",18),e.EFF(46),e.k0s()()()()()),2&n&&(e.R7$(),e.Y8G("formGroup",r.promoForm),e.R7$(3),e.Y8G("isNew",!1)("mediaData",null==r.mediaData?null:r.mediaData.image),e.R7$(5),e.Y8G("ngForOf",r.stores),e.R7$(5),e.Y8G("ngForOf",e.ziG(22,ne,e.lJ4(18,ee),e.lJ4(19,te),e.lJ4(20,oe),e.lJ4(21,re))),e.R7$(),e.Y8G("ngIf",1===r.promoForm.value.applicableType||2===r.promoForm.value.applicableType),e.R7$(),e.Y8G("ngIf",1===r.promoForm.value.applicableType),e.R7$(),e.Y8G("ngIf",0===r.promoForm.value.applicableType||2===r.promoForm.value.applicableType||3===r.promoForm.value.applicableType),e.R7$(),e.Y8G("ngIf",3===r.promoForm.value.applicableType),e.R7$(5),e.Y8G("ngForOf",e.lJ4(27,ae)),e.R7$(),e.Y8G("ngIf","Single menu"===r.promoForm.value.offerType||"Single Item"===r.promoForm.value.offerType&&r.selectedStore),e.R7$(),e.Y8G("ngIf","Single Item"===r.promoForm.value.offerType&&r.selectMenu),e.R7$(5),e.Y8G("ngForOf",e.lJ4(28,ie)),e.R7$(),e.Y8G("ngIf","One Time"===r.promoForm.value.offerPeriodType),e.R7$(),e.Y8G("ngIf","Recurring"===r.promoForm.value.offerPeriodType),e.R7$(9),e.Y8G("ngForOf",e.l_i(31,me,e.lJ4(29,se),e.lJ4(30,fe))),e.R7$(4),e.Y8G("disabled",r.promoForm.invalid),e.R7$(),e.JRh(r.isLoading?"CHECKING...":"SAVE"))},dependencies:[l.Sq,l.bT,I.wT,v.It,v.$z,h.rl,h.nJ,h.TL,h.yw,T.An,N.fg,R.VO,x.So,d.bU,d.el,d.xR,d.IG,d.SG,u.DJ,u.BO,u.sA,u.UI,s.qT,s.me,s.Q0,s.BC,s.cb,s.j4,s.JD,s.$R,s.v8,Y.C,y.gu]})}return o})(),M=(()=>{class o{constructor(t){this.offersService=t}resolve(){return this.offersService.getOffers()}static#e=this.\u0275fac=function(n){return new(n||o)(e.KVO(g))};static#t=this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),L=(()=>{class o{constructor(t){this.offerService=t}resolve(t){const n=t.paramMap.get("id");return this.offerService.getOffer(n)}static#e=this.\u0275fac=function(n){return new(n||o)(e.KVO(g))};static#t=this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var V=f(850);const Se=["customerInput"],Ge=["auto"],$e=["storeInput"],je=["storeAuto"],Ie=()=>({name:"Discount",value:0}),Ne=()=>({name:"Buy x get x free",value:1}),Re=()=>({name:"Buy x, Get %(x) Off",value:2}),xe=()=>({name:"%(x) Off, up to (x) amount of order",value:3}),Ye=(o,a,t,n)=>[o,a,t,n],Me=()=>["Entire menu","Single menu","Single Item"],Le=()=>["One Time","Recurring"],Ve=()=>({name:"Enable",value:!0}),Ae=()=>({name:"Disable",value:!1}),Je=(o,a)=>[o,a];function Pe(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.name," ")}}function Be(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.name," ")}}function Xe(o,a){1&o&&(e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Enter the quantity the buyer needs to order"),e.k0s(),e.nrm(3,"input",26),e.k0s())}function Ue(o,a){1&o&&(e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Enter to the quantity the buy will receive"),e.k0s(),e.nrm(3,"input",27),e.k0s())}function We(o,a){1&o&&(e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Enter the discount"),e.k0s(),e.nrm(3,"input",28),e.j41(4,"mat-icon",29),e.EFF(5,"percent"),e.k0s()())}function Ke(o,a){1&o&&(e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Enter the amount"),e.k0s(),e.nrm(3,"input",30),e.j41(4,"mat-icon",29),e.EFF(5,"money"),e.k0s()())}function Ze(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function ze(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.name," ")}}function Qe(o,a){if(1&o){const t=e.RV6();e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Select a menu"),e.k0s(),e.nrm(3,"input",31,2),e.j41(5,"mat-autocomplete",12,3),e.bIt("optionSelected",function(r){e.eBV(t);const i=e.XpG();return e.Njj(i.selectedMenu(r))}),e.DNE(7,ze,2,2,"mat-option",13),e.nI1(8,"async"),e.k0s()()}if(2&o){const t=e.sdS(6),n=e.XpG();e.R7$(3),e.Y8G("formControl",n.menuCtrl)("matAutocomplete",t),e.R7$(2),e.Y8G("displayWith",n.displayFn),e.R7$(2),e.Y8G("ngForOf",e.bMT(8,4,n.filteredMenus))}}function qe(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t._id),e.R7$(),e.SpI(" ",t.name," ")}}function He(o,a){if(1&o&&(e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Select a menu Item"),e.k0s(),e.j41(3,"mat-select",32),e.DNE(4,qe,2,2,"mat-option",13),e.k0s()()),2&o){const t=e.XpG();e.R7$(4),e.Y8G("ngForOf",t.selectMenu.foods)}}function et(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function tt(o,a){1&o&&(e.j41(0,"mat-error"),e.EFF(1,"Invalid start date"),e.k0s())}function ot(o,a){1&o&&(e.j41(0,"mat-error"),e.EFF(1,"Invalid end date"),e.k0s())}function rt(o,a){if(1&o&&(e.j41(0,"mat-form-field",14)(1,"mat-label"),e.EFF(2,"Offer Start/End Period"),e.k0s(),e.j41(3,"mat-date-range-input",33),e.nrm(4,"input",34)(5,"input",35),e.k0s(),e.nrm(6,"mat-datepicker-toggle",36)(7,"mat-date-range-picker",null,4),e.DNE(9,tt,2,0,"mat-error",37)(10,ot,2,0,"mat-error",37),e.k0s()),2&o){const t=e.sdS(8),n=e.XpG();e.R7$(3),e.Y8G("rangePicker",t),e.R7$(3),e.Y8G("for",t),e.R7$(3),e.Y8G("ngIf",n.range.controls.start.hasError("matStartDateInvalid")),e.R7$(),e.Y8G("ngIf",n.range.controls.end.hasError("matEndDateInvalid"))}}function nt(o,a){if(1&o&&(e.j41(0,"div",40),e.qex(1,41),e.j41(2,"mat-checkbox",42),e.EFF(3),e.k0s(),e.nrm(4,"ngx-mat-timepicker",43)(5,"ngx-mat-timepicker",44),e.bVm(),e.k0s()),2&o){const t=a.$implicit,n=a.index;e.R7$(),e.Y8G("formGroupName",n),e.R7$(2),e.JRh(t.value.day),e.R7$(),e.Y8G("enableMeridian",!0),e.R7$(),e.Y8G("enableMeridian",!0)}}function at(o,a){if(1&o&&(e.j41(0,"div",38),e.DNE(1,nt,6,4,"div",39),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.offerPeriods.controls)}}function it(o,a){if(1&o&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.SpI(" ",t.name," ")}}const st=[{path:"",component:A,children:[{path:"list",component:Z,resolve:{offers:M}},{path:"new-offer",component:(()=>{class o{constructor(t,n,r,i,m,c,S){this.fb=t,this.offersService=n,this.usersService=r,this.storesService=i,this.location=m,this.dialog=c,this.menuService=S,this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.separatorKeysCodes=[b.Fm,b.KE],this.menuCtrl=new s.MJ,this.storeCtrl=new s.MJ,this.isLoading=!1,this.selectedCustomers=[],this.range=new s.gE({start:new s.MJ(null),end:new s.MJ(null)}),this.panelOpenState=!1,this.availableDays=[{day:"Sunday",active:!0,startDate:new Date,endDate:new Date},{day:"Monday",active:!0,startDate:new Date,endDate:new Date},{day:"Tuesday",active:!0,startDate:new Date,endDate:new Date},{day:"Wednesday",active:!0,startDate:new Date,endDate:new Date},{day:"Thursday",active:!0,startDate:new Date,endDate:new Date},{day:"Friday",active:!0,startDate:new Date,endDate:new Date},{day:"Saturday",active:!0,startDate:new Date,endDate:new Date}],this.filteredDays=[],this.menus=[],this.stores=[],this.promoForm=this.fb.group({image:[""],menu:[null],food:[null],applicableType:["",s.k0.required],quantityForFree:[0],quantityToOrder:[0],offerType:["",s.k0.required],offerPeriodType:["",s.k0.required],offerPeriodDays:this.fb.array([]),store:[""],discount:[0],amount:[0],startTime:[this.range.value.start],endTime:[this.range.value.end],description:["",s.k0.required],enabled:[!1,s.k0.required]}),this.availableDays.forEach(p=>{this.addOfferPeriods(p)}),this.getStores(),this.mediaData={image:null,icon:null},this.filteredMenus=this.menuCtrl.valueChanges.pipe((0,E.Z)(null),(0,C.T)(p=>p?this._filter(p):this.menus.slice())),this.filteredStores=this.storeCtrl.valueChanges.pipe((0,E.Z)(null),(0,C.T)(p=>p?this._filterStore(p):this.stores.slice()))}addOfferPeriods(t){const n=this.fb.group({day:t.day,active:t.active,startDate:t.startDate,endDate:t.endDate});this.offerPeriods.push(n)}get offerPeriods(){return this.promoForm.controls.offerPeriodDays}ngOnInit(){}_filter(t){if("string"==typeof t){const n=t?.toLowerCase();return this.menus?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}{const n=t.name.toLowerCase();return this.menus?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}}_filterStore(t){if("string"==typeof t){const n=t?.toLowerCase();return this.stores?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}{const n=t.name.toLowerCase();return this.stores?.filter(r=>0===r?.name?.toLowerCase().indexOf(n))}}displayFn(t){return t?.name}submit(){if(this.promoForm.valid){let t=this.promoForm.getRawValue();t.store=this.selectedStore._id,t.menu=this.selectMenu?._id,this.isLoading=!0,this.offersService.createOffer(t).subscribe(n=>{this.isLoading=!1,this.location.back()})}}selectStore(t){this.selectedStore=t.option.value,setTimeout(()=>{this.getMenu()},2e3)}getMenu(){this.selectedStore&&this.menuService.getStoreMenus(this.selectedStore._id).subscribe(t=>{this.menus=t})}selectedMenu(t){this.selectMenu=t.option.value}getStores(){this.storesService.getStores({data:{$match:{}},control:[{$sort:{createdAt:-1}}]}).subscribe(t=>{this.stores=t})}back(){this.location.back()}addMedia(t){this.dialog.open($.w).afterClosed().subscribe(r=>{r&&(this.promoForm.patchValue({[t]:r.url}),this.mediaData[t]={[t]:r}[t])})}removeValue(t){this.promoForm.patchValue({[t]:null}),this.mediaData[t]=null}static#e=this.\u0275fac=function(n){return new(n||o)(e.rXU(s.ok),e.rXU(g),e.rXU(w.g),e.rXU(j.a),e.rXU(l.aZ),e.rXU(D.bZ),e.rXU(k.g))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-new-offer"]],viewQuery:function(n,r){if(1&n&&(e.GBs(Se,5),e.GBs(Ge,5),e.GBs($e,5),e.GBs(je,5)),2&n){let i;e.mGM(i=e.lsd())&&(r.customerInput=i.first),e.mGM(i=e.lsd())&&(r.matAutocomplete=i.first),e.mGM(i=e.lsd())&&(r.storeInput=i.first),e.mGM(i=e.lsd())&&(r.matAutocompleteStore=i.first)}},decls:51,vars:39,consts:[["storeInput",""],["storeAuto","matAutocomplete"],["menuInput",""],["menuAuto","matAutocomplete"],["picker",""],[1,"mat-elevation-z3","container","mx-auto","my-10","container-md","p-5"],[3,"ngSubmit","formGroup"],["fxLayout","column","fxLayoutAlign","start start"],["fxLayout","column","fxLayoutAlign","center center",1,"m-3","w-full"],["valueName","Image",3,"removeValue","openMediaBrowser","isNew","mediaData"],["fxFlex.gt-md","50%","fxFlex.lt-lg","100%",1,"w-full"],["matInput","","cancellation","Select a vendor","formControlName","store",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full"],["formControlName","applicableType"],["class","w-full",4,"ngIf"],["formControlName","offerType"],["formControlName","offerPeriodType"],["formArrayName","offerPeriodDays","class","w-full",4,"ngIf"],["matInput","","cancellation","Text Description","formControlName","description"],["formControlName","enabled"],["fxLayout.gt-md","row","fxLayoutAlign.gt-md","space-around start","fxLayout.lt-lg","column","fxLayoutAlign.lt-lg","space-around stretch","fxLayoutGap","10px",1,"w-full"],["mat-raised-button","","fxFlex","50%",3,"click"],["mat-raised-button","","fxFlex","50%","color","primary",3,"disabled"],[3,"value"],["matInput","","type","number","cancellation","Enter the quantity the buyer needs to order","formControlName","quantityToOrder"],["matInput","","type","number","cancellation","Enter to the quantity the buyer will receive","formControlName","quantityForFree"],["matInput","","type","number","cancellation","Enter Discount","formControlName","discount"],["matSuffix",""],["matInput","","type","number","cancellation","Enter amount","formControlName","amount"],["matInput","","cancellation","Select a menu","formControlName","menu",3,"formControl","matAutocomplete"],["formControlName","food"],[3,"rangePicker"],["matStartDate","","formControlName","startTime","placeholder","Start date"],["matEndDate","","formControlName","endTime","placeholder","End date"],["matSuffix","",3,"for"],[4,"ngIf"],["formArrayName","offerPeriodDays",1,"w-full"],["class","p-3 border-b-2 border-b-gray w-full","fxLayout","row","fxLayoutAlign","space-around center",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","space-around center",1,"p-3","border-b-2","border-b-gray","w-full"],[3,"formGroupName"],["formControlName","active"],["formControlName","startDate",3,"enableMeridian"],["formControlName","endDate",3,"enableMeridian"]],template:function(n,r){if(1&n){const i=e.RV6();e.j41(0,"div",5)(1,"form",6),e.bIt("ngSubmit",function(){return e.eBV(i),e.Njj(r.submit())}),e.j41(2,"div",7)(3,"div",8)(4,"app-select-media",9),e.bIt("removeValue",function(c){return e.eBV(i),e.Njj(r.removeValue(c))})("openMediaBrowser",function(c){return e.eBV(i),e.Njj(r.addMedia(c))}),e.k0s()(),e.j41(5,"mat-form-field",10)(6,"mat-label"),e.EFF(7,"Select a vendor"),e.k0s(),e.nrm(8,"input",11,0),e.j41(10,"mat-autocomplete",12,1),e.bIt("optionSelected",function(c){return e.eBV(i),e.Njj(r.selectStore(c))}),e.DNE(12,Pe,2,2,"mat-option",13),e.nI1(13,"async"),e.k0s()(),e.j41(14,"mat-form-field",14)(15,"mat-label"),e.EFF(16,"What kind of offer do you want create?"),e.k0s(),e.j41(17,"mat-select",15),e.DNE(18,Be,2,2,"mat-option",13),e.k0s()(),e.DNE(19,Xe,4,0,"mat-form-field",16)(20,Ue,4,0,"mat-form-field",16)(21,We,6,0,"mat-form-field",16)(22,Ke,6,0,"mat-form-field",16),e.j41(23,"mat-form-field",14)(24,"mat-label"),e.EFF(25,"Where do you want to apply this offer?"),e.k0s(),e.j41(26,"mat-select",17),e.DNE(27,Ze,2,2,"mat-option",13),e.k0s()(),e.DNE(28,Qe,9,6,"mat-form-field",16)(29,He,5,1,"mat-form-field",16),e.j41(30,"mat-form-field",14)(31,"mat-label"),e.EFF(32,"Offer Period Type"),e.k0s(),e.j41(33,"mat-select",18),e.DNE(34,et,2,2,"mat-option",13),e.k0s()(),e.DNE(35,rt,11,4,"mat-form-field",16)(36,at,2,1,"div",19),e.j41(37,"mat-form-field",14)(38,"mat-label"),e.EFF(39,"Description"),e.k0s(),e.nrm(40,"textarea",20),e.k0s(),e.j41(41,"mat-form-field",14)(42,"mat-label"),e.EFF(43,"Enabled?"),e.k0s(),e.j41(44,"mat-select",21),e.DNE(45,it,2,2,"mat-option",13),e.k0s()(),e.j41(46,"div",22)(47,"a",23),e.bIt("click",function(){return e.eBV(i),e.Njj(r.back())}),e.EFF(48,"CANCEL"),e.k0s(),e.j41(49,"button",24),e.EFF(50),e.k0s()()()()()}if(2&n){const i=e.sdS(11);e.R7$(),e.Y8G("formGroup",r.promoForm),e.R7$(3),e.Y8G("isNew",!1)("mediaData",null==r.mediaData?null:r.mediaData.image),e.R7$(4),e.Y8G("formControl",r.storeCtrl)("matAutocomplete",i),e.R7$(2),e.Y8G("displayWith",r.displayFn),e.R7$(2),e.Y8G("ngForOf",e.bMT(13,21,r.filteredStores)),e.R7$(6),e.Y8G("ngForOf",e.ziG(27,Ye,e.lJ4(23,Ie),e.lJ4(24,Ne),e.lJ4(25,Re),e.lJ4(26,xe))),e.R7$(),e.Y8G("ngIf",1===r.promoForm.value.applicableType||2===r.promoForm.value.applicableType),e.R7$(),e.Y8G("ngIf",1===r.promoForm.value.applicableType),e.R7$(),e.Y8G("ngIf",0===r.promoForm.value.applicableType||2===r.promoForm.value.applicableType||3===r.promoForm.value.applicableType),e.R7$(),e.Y8G("ngIf",3===r.promoForm.value.applicableType),e.R7$(5),e.Y8G("ngForOf",e.lJ4(32,Me)),e.R7$(),e.Y8G("ngIf","Single menu"===r.promoForm.value.offerType||"Single Item"===r.promoForm.value.offerType&&r.selectedStore),e.R7$(),e.Y8G("ngIf","Single Item"===r.promoForm.value.offerType&&r.selectMenu),e.R7$(5),e.Y8G("ngForOf",e.lJ4(33,Le)),e.R7$(),e.Y8G("ngIf","One Time"===r.promoForm.value.offerPeriodType),e.R7$(),e.Y8G("ngIf","Recurring"===r.promoForm.value.offerPeriodType),e.R7$(9),e.Y8G("ngForOf",e.l_i(36,Je,e.lJ4(34,Ve),e.lJ4(35,Ae))),e.R7$(4),e.Y8G("disabled",r.promoForm.invalid),e.R7$(),e.JRh(r.isLoading?"CHECKING...":"SAVE")}},dependencies:[l.Sq,l.bT,V.$3,I.wT,V.pN,v.It,v.$z,h.rl,h.nJ,h.TL,h.yw,T.An,N.fg,R.VO,x.So,d.bU,d.el,d.xR,d.IG,d.SG,u.DJ,u.BO,u.sA,u.UI,s.qT,s.me,s.Q0,s.BC,s.cb,s.l_,s.j4,s.JD,s.$R,s.v8,Y.C,y.gu,l.Jj]})}return o})()},{path:":id/edit",component:ke,resolve:{offer:L}}]}];let ft=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.$C({type:o});static#o=this.\u0275inj=e.G2t({imports:[F.iI.forChild(st),F.iI]})}return o})();var mt=f(6924),lt=f(3457),ct=f(3887);let ut=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.$C({type:o});static#o=this.\u0275inj=e.G2t({providers:[M,L,g,w.g,k.g],imports:[l.MD,ft,lt.G,mt.YF,s.X1,s.YN,ct.G,y.Hw,y.T_,y.Xg]})}return o})()}}]);